<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/favicons/manifest.json">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div class="beta">beta</div><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><a href="/docs/get_started">get started</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/developer_guide">developer guide</a><div class="underline"></div></li><li class="docs-navigation-item active"><a href="/docs/packages">packages</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/migration">migration</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a><a href="http://cerebral-website.herokuapp.com/" class="docs-icon" target="_new" style="color:#DD4A68;">old website</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger"></div><div class="docs-navigation-title mobile">packages</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item mobile"><a href="/docs/get_started">get started</a></li><li class="docs-navigation-item mobile"><a href="/docs/developer_guide">developer guide</a></li><li class="docs-navigation-item active mobile"><a href="/docs/packages">packages</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/packages/index.html">cerebral-router</a></li><li class="active"><a href="/docs/packages/http.html">cerebral-provider-http</a><ul><li><a href="#install">install</a></li><li><a href="#description">description</a></li><li><a href="#instantiate">instantiate</a></li><li><a href="#error">error</a><ul><li><a href="#httpprovidererror">HttpProviderError</a></li></ul></li><li><a href="#request">request</a></li><li><a href="#get">get</a></li><li><a href="#post">post</a></li><li><a href="#put">put</a></li><li><a href="#patch">patch</a></li><li><a href="#delete">delete</a></li><li><a href="#uploadfile">uploadFile</a></li><li><a href="#response">response</a></li><li><a href="#abort">abort</a></li><li><a href="#cors">cors</a></li></ul></li><li><a href="/docs/packages/firebase.html">cerebral-provider-firebase</a></li><li><a href="/docs/packages/useragent.html">cerebral-module-useragent</a></li><li><a href="/docs/packages/forms.html">cerebral-provider-forms</a></li><li><a href="/docs/packages/storage.html">cerebral-provider-storage</a></li><li><a href="/docs/packages/function_tree.html">function-tree</a></li><li><a href="/docs/packages/firebase_admin.html">function-tree-firebase-admin</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/migration">migration</a></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/packages/index.html">cerebral-router</a></li><li class="active"><a href="/docs/packages/http.html">cerebral-provider-http</a><ul><li><a href="#install">install</a></li><li><a href="#description">description</a></li><li><a href="#instantiate">instantiate</a></li><li><a href="#error">error</a><ul><li><a href="#httpprovidererror">HttpProviderError</a></li></ul></li><li><a href="#request">request</a></li><li><a href="#get">get</a></li><li><a href="#post">post</a></li><li><a href="#put">put</a></li><li><a href="#patch">patch</a></li><li><a href="#delete">delete</a></li><li><a href="#uploadfile">uploadFile</a></li><li><a href="#response">response</a></li><li><a href="#abort">abort</a></li><li><a href="#cors">cors</a></li></ul></li><li><a href="/docs/packages/firebase.html">cerebral-provider-firebase</a></li><li><a href="/docs/packages/useragent.html">cerebral-module-useragent</a></li><li><a href="/docs/packages/forms.html">cerebral-provider-forms</a></li><li><a href="/docs/packages/storage.html">cerebral-provider-storage</a></li><li><a href="/docs/packages/function_tree.html">function-tree</a></li><li><a href="/docs/packages/firebase_admin.html">function-tree-firebase-admin</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/packages/http.md" target="_new">Edit on Github</a></div><h1 id="cerebral-provider-http">cerebral-provider-http</h1><h2 id="install">install</h2><p><strong>NPM</strong></p><p><code>npm install cerebral-provider-http@next --save --save-exact</code></p><p><strong>YARN</strong></p><p><code>yarn add cerebral-provider-http@next --exact</code></p><h2 id="description">description</h2><p>The HTTP provider exposes the ability to do HTTP requests both in actions and directly in signals. It supports <strong>cors</strong> and file upload, with progress handling. It default to <strong>json</strong>, but you can configure it to whatever you want.</p><pre><code class="language-js">import {set} from &#x27;cerebral/operators&#x27;
import {httpGet} from &#x27;cerebral-provider-http/operators&#x27;
import {state, props} from &#x27;cerebral/tags&#x27;

export default [
  httpGet(`/items/${props`itemKey`}`),
  set(state`app.currentItem`, props`result`)
]</code></pre><p>All factories of HTTP provider supports template tags.</p><h2 id="instantiate">instantiate</h2><pre><code class="language-js">import {Controller} from &#x27;cerebral&#x27;
import HttpProvider from &#x27;cerebral-provider-http&#x27;

const controller = Controller({
  providers: [
    HttpProvider({
      // Prefix all requests with this url
      baseUrl: &#x27;https://api.github.com&#x27;,

      // Any default headers to pass on requests
      headers: {
        &#x27;Content-Type&#x27;: &#x27;application/json; charset=UTF-8&#x27;,
        &#x27;Accept&#x27;: &#x27;application/json&#x27;
      },

      // When talking to cross origin (cors), pass cookies
      // if set to true
      withCredentials: false
    })
  ]
})</code></pre><p>You can update these default options in an action:</p><pre><code class="language-js">function updateDefaultHttpOptions({http}) {
  http.updateOptions({
    // Updated options
  })
}</code></pre><h2 id="error">error</h2><h3 id="httpprovidererror">HttpProviderError</h3><pre><code class="language-js">import {HttpProviderError} from &#x27;cerebral-provider-http&#x27;

// Error structure
{
  name: &#x27;HttpProviderError&#x27;,
  message: &#x27;Some potential error message&#x27;,
  body: &#x27;Message or response body&#x27;,
  status: 200,
  isAborted: false,
  headers: {},
  stack: &#x27;...&#x27;  
}</code></pre><h2 id="request">request</h2><pre><code class="language-js">function someGetAction ({http}) {
  return http.request({
    // Any http method
    method: &#x27;GET&#x27;,

    // Url you want to request to
    url: &#x27;/items&#x27;

    // Request body as object. Will automatically be stringified if json and
    // urlEncoded if application/x-www-form-urlencoded
    body: {},

    // Query as object, will automatically be urlEncoded
    query: {},

    // If cross origin request, pass cookies
    withCredentials: false,

    // Any additional http headers, or overwrite default
    headers: {},

    // A function or signal path (foo.bar.requestProgressed) that
    // triggers on request progress. Passes {progress: 45} etc.
    onProgress: null
  })
}</code></pre><h2 id="get">get</h2><p><em>action</em></p><pre><code class="language-js">function someGetAction ({http}) {
  return http.get(&#x27;/items&#x27;, {
    // QUERY object
  }, {
    // Any options defined in &quot;Custom request&quot;
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpGet} from &#x27;cerebral-provider-http/operators&#x27;

export default [
  httpGet(&#x27;/items&#x27;),

  // Alternatively with explicit paths
  httpGet(&#x27;/items&#x27;), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="post">post</h2><p><em>action</em></p><pre><code class="language-js">function somePostAction ({http}) {
  return http.post(&#x27;/items&#x27;, {
    // BODY object
  }, {
    // Any options defined in &quot;Custom request&quot;
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpPost} from &#x27;cerebral-provider-http/operators&#x27;
import {props} from &#x27;cerebral/tags&#x27;

export default [
  httpPost(&#x27;/items&#x27;, {
    title: props`itemTitle`,
    foo: &#x27;bar&#x27;
  }),

  // Alternatively with explicit paths
  httpPost(&#x27;/items&#x27;, {
    title: props`itemTitle`,
    foo: &#x27;bar&#x27;
  }), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="put">put</h2><p><em>action</em></p><pre><code class="language-js">function somePutAction ({http}) {
  return http.put(&#x27;/items/1&#x27;, {
    // BODY object
  }, {
    // Any options defined in &quot;Custom request&quot;
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpPost} from &#x27;cerebral-provider-http/operators&#x27;

export default [
  httpPut(&#x27;/items&#x27;, {
    // BODY object
  }),

  // Alternatively with explicit paths
  httpPut(&#x27;/items&#x27;, {
    // BODY object
  }), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="patch">patch</h2><p><em>action</em></p><pre><code class="language-js">function somePatchAction ({http}) {
  return http.patch(&#x27;/items/1&#x27;, {
    // BODY object
  }, {
    // Any options defined in &quot;Custom request&quot;
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpPost} from &#x27;cerebral-provider-http/operators&#x27;
import {state, props, string} from &#x27;cerebral/tags&#x27;

export default [
  httpPatch(string`/items/${props`itemId`}`, state`patchData`),

  // Alternatively with explicit paths
  httpPatch(string`/items/${props`itemId`}`, state`patchData`), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="delete">delete</h2><p><em>action</em></p><pre><code class="language-js">function someDeleteAction ({http}) {
  return http.delete(&#x27;/items/1&#x27;, {
    // QUERY object
  }, {
    // Any options defined in &quot;Custom request&quot;
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpPost} from &#x27;cerebral-provider-http/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default [
  httpDelete(string`/items/${state`currentItemId`}`),

  // Alternatively with explicit paths
  httpDelete(string`/items/${state`currentItemId`}`), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="uploadfile">uploadFile</h2><p><em>action</em></p><pre><code class="language-js">function someDeleteAction ({http, props}) {
  return http.uploadFile(&#x27;/upload&#x27;, props.files, {
    name: &#x27;filename.png&#x27;, // Default to &quot;files&quot;
    data: {}, // Additional form data
    headers: {},
    onProgress(progress) {} // Upload progress
  })
}</code></pre><p><em>factory</em></p><pre><code class="language-js">import {httpUploadFile} from &#x27;cerebral-provider-http/operators&#x27;
import {state, props} from &#x27;cerebral/tags&#x27;

export default [
  httpUploadFile(&#x27;/uploads&#x27;, props`file`, {
    name: state`currentFileName`
  }),

  // Alternatively with explicit paths
  httpUploadFile(&#x27;/uploads&#x27;, props`file`, {
    name: state`currentFileName`
  }), {
    success: [],
    error: [],
    abort: [], // Optional
    &#x27;${STATUS_CODE}&#x27;: [] // Optionally any status code, ex. 404: []
  }
]</code></pre><p><em>output</em></p><pre><code class="language-javascript">{
  result: &#x27;the response&#x27;,
  status: 200,

  // If aborted
  isAborted: true
}</code></pre><h2 id="response">response</h2><pre><code class="language-js">function someGetAction ({http}) {
  return http.get(&#x27;/items&#x27;)
    // All status codes between 200 - 300, including 200
    .then((response) =&gt; {
      response.status // Status code of response
      response.result // Parsed response text
      // The response headers are returned as an object with lowercase header
      // names as keys. Values belonging to the same key are separated by &#x27;, &#x27;.
      response.headers // Parsed response headers
    })
    // All other status codes
    .catch((error) =&gt; {
      // HttpProviderError
      error.message // {status: 500, result: &#x27;response text&#x27;, headers: {}, isAborted: false}
    })
}</code></pre><h2 id="abort">abort</h2><p>You can abort any running request, causing the request to resolve as status code <strong>0</strong> and set an <strong>isAborted</strong> property on the response object.</p><pre><code class="language-js">function searchItems({input, state, path, http}) {
  http.abort(&#x27;/items*&#x27;) // regexp string
  return http.get(`/items?query=${input.query}`)
    .then(path.success)
    .catch((error) =&gt; {
      if (error.message.isAborted) {
        return path.abort()
      }

      return path.error({error: error.message})
    })
}

export default [
  searchItems, {
    success: [],
    error: [],
    abort: []
  }
]</code></pre><h2 id="cors">cors</h2><p>Cors has been turned into a “black box” by jQuery. Cors is actually a very simple concept, but due to a lot of confusion of “Request not allowed”, <strong>cors</strong> has been an option to help out. In HttpProvider we try to give you the insight to understand how cors actually works.</p><p>Cors has nothing to do with the client. The only client configuration related to cors is the <strong>withCredentials</strong> option, which makes sure cookies are passed to the cross origin server. The only requirement for cors to work is that you pass the correct <strong>Content-Type</strong>. Now, this depends on the server in question. Some servers allows any content-type, others require a specific one. These are the typical ones:</p><ul><li>text/plain</li><li>application/x-www-form-urlencoded</li><li>application/json; charset=UTF-8</li></ul><p>Note that this is only related to the <strong>request</strong>. If you want to define what you want as response, you set the <strong>Accept</strong> header, which is <em>application/json</em> by default.</p></div></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
