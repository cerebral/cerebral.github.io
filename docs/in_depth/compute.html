<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><span>install</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/install/index.html">Cerebral</a><a class="docs-navigation-subItem" href="/docs/install/boilerplate.html">Boilerplates</a><a class="docs-navigation-subItem" href="/docs/install/tools.html">Tools</a><a class="docs-navigation-subItem" href="/docs/install/function_tree.html">Function Tree</a></div></li><li class="docs-navigation-item"><span>tutorial</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/tutorial/index.html">Introduction</a><a class="docs-navigation-subItem" href="/docs/tutorial/define_state.html">Define State</a><a class="docs-navigation-subItem" href="/docs/tutorial/render_state.html">Render state</a><a class="docs-navigation-subItem" href="/docs/tutorial/update_state.html">Update state</a><a class="docs-navigation-subItem" href="/docs/tutorial/chains.html">Chains</a><a class="docs-navigation-subItem" href="/docs/tutorial/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/async_actions.html">Async actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/paths.html">Paths</a><a class="docs-navigation-subItem" href="/docs/tutorial/compute_state.html">Compute state</a><a class="docs-navigation-subItem" href="/docs/tutorial/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/tutorial/routing.html">Routing</a><a class="docs-navigation-subItem" href="/docs/tutorial/modules.html">Modules</a></div></li><li class="docs-navigation-item active"><span>in depth</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/in_depth/index.html">The architecture</a><a class="docs-navigation-subItem" href="/docs/in_depth/controller.html">Controller</a><a class="docs-navigation-subItem" href="/docs/in_depth/state.html">State</a><a class="docs-navigation-subItem" href="/docs/in_depth/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/in_depth/chains_and_paths.html">Chains and paths</a><a class="docs-navigation-subItem" href="/docs/in_depth/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/in_depth/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/in_depth/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/in_depth/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/in_depth/factories.html">Factories</a><a class="docs-navigation-subItem" href="/docs/in_depth/connect.html">Connect</a><a class="docs-navigation-subItem active" href="/docs/in_depth/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/in_depth/routing.html">Routing</a></div></li><li class="docs-navigation-item"><span>best practices</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/best_practices/index.html">Organizing</a><a class="docs-navigation-subItem" href="/docs/best_practices/constants.html">Constants</a><a class="docs-navigation-subItem" href="/docs/best_practices/testing.html">Testing</a><a class="docs-navigation-subItem" href="/docs/best_practices/load_initial_data.html">Load initial data</a><a class="docs-navigation-subItem" href="/docs/best_practices/storing_server_data.html">Storing server data</a><a class="docs-navigation-subItem" href="/docs/best_practices/lists.html">Lists</a><a class="docs-navigation-subItem" href="/docs/best_practices/modals.html">Modals</a><a class="docs-navigation-subItem" href="/docs/best_practices/feedback_messages.html">Feedback messages</a><a class="docs-navigation-subItem" href="/docs/best_practices/popups.html">Popups</a><a class="docs-navigation-subItem" href="/docs/best_practices/long_running_side_effects.html">Long running side effects</a><a class="docs-navigation-subItem" href="/docs/best_practices/server_side.html">Server side</a></div></li><li class="docs-navigation-item"><span>migration</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/migration/index.html">From 1.x to 2.x</a></div></li><li class="docs-navigation-item"><span>api</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/api/index.html">Controller</a><a class="docs-navigation-subItem" href="/docs/api/state.html">State</a><a class="docs-navigation-subItem" href="/docs/api/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/api/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/api/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/api/modules.html">Modules</a><a class="docs-navigation-subItem" href="/docs/api/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/api/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/api/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/api/router.html">Router</a></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="#compute">Compute</a><ul><li><a href="#relational-data">Relational data</a></li></ul></li></ul></div></div><div class="docs-doc"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/docs/docs/in_depth/compute.md" target="_new">Edit on Github</a></div><div class="docs-doc-content"><div style="background-color:#DD4A68;color:#fff;margin:10px;padding:5px 10px;border-radius:3px;">Docs are still being written and might not be up to date with API</div><h1 id="compute">Compute</h1><p>Very often the components needs to produce state based on a combination of other state. A very typical example is to show items of a list based on a dynamic limit. The whole list is stored in your state tree, but you only want to show for example the 10 latest. Instead of defining this in the component itself, you can use <strong>compute</strong>.</p><pre><code class="language-js">import {compute} from &#x27;cerebral&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default compute(
  state`items.limit`,
  state`items.list`,
  (limit, list) =&gt; {
    return items.filter((item, index) =&gt; index &lt; limit)    
  }
)</code></pre><p>To use this computed in your component:</p><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import limitedList from &#x27;../../computed/limitedList&#x27;

export default connect({
  limitedList
},
  function List(props) {
    props.limitedList
  }
)</code></pre><p>It would also be possible to pass in the limit as a property, maybe from the props passed into the component:</p><pre><code class="language-js">import {compute} from &#x27;cerebral&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default function (passedLimit) {
  return compute(
    passedLimit,
    state`items.limit`,
    (limit, list) =&gt; {
      return items.filter((item, index) =&gt; index &lt; limit)    
    }
  )
}</code></pre><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import limitedList from &#x27;../../computed/limitedList&#x27;

export default connect({
  limitedList: limitedList(props`limit`)
},
  function List(props) {
    props.limitedList
  }
)</code></pre><p>The computed, if connected to a component, will only run again if any of its state or props dependencies has changed. When computed is used in signals and actions they will always evaluate the value.</p><h3 id="relational-data">Relational data</h3><p>A challenge using a single state tree is handling relational data. Since data is typically stored in multiple places you need to bring them together. For example a user with projects. In Cerebral we favor storing data as objects due to advantages of lookups and optimistically creating new items. Let us look at an example of a state tree:</p><pre><code class="language-js">{
  users: {
    &#x27;user-1&#x27;: {
      name: &#x27;Bob&#x27;,
      projects: [&#x27;project-1&#x27;, &#x27;project-2&#x27;]
    },
    &#x27;user-2&#x27;: {
      name: &#x27;Dale&#x27;,
      projects: [&#x27;project-1&#x27;]
    }
  },
  projects: {
    &#x27;project-1&#x27;: {title: &#x27;Awesome project&#x27;},
    &#x27;project-2&#x27;: {title: &#x27;Also awesome project&#x27;}
  }
}</code></pre><p>We want to display a user with its related projects. What to think of now is that even though projects relate to users it is not always the case that we want to show this data together. Maybe we only want to show data related to the user itself, or only the project. That is why we express this relationship when we bring the data into the component. So for example, only showing the user:</p><pre><code class="language-js">// Only a user
connect({
  user: state`users.${props`userKey`}`
})
// Only a project
connect({
  user: state`projects.${props`projectKey`}`
})</code></pre><p>If you want to bring in a user and its related projects you can define a computed for that. The way you would bring it into connect could be:</p><pre><code class="language-js">connect({
  user: user(props`userKey`)
})</code></pre><p>You would define <strong>user</strong> as:</p><pre><code class="language-js">function user (passedUserKey) {
  return compute(
    passedUserKey,
    (userKey, get) =&gt; {
      const user = get(state`users.${userKey}`)

      return {
        ...user,
        projects: user.projectIds.map((id) =&gt; get(state`projects.${id}`))
      }
    }
  )
}</code></pre><p>Now your component depends on the user and any changes to its children. It also depends on each specific project of the user and any changes to their children.</p><p>But you could split this up. You could keep the <strong>user</strong> as:</p><pre><code class="language-js">function user (passedUserKey) {
  return compute(
    passedUserKey,
    (userKey, get) =&gt; {
      return get(state`users.${userKey}`)
    }
  )
}</code></pre><p>And rather add a new compute to grab the projects:</p><pre><code class="language-js">const userProjects = compute((user, get) =&gt; {
  return {
    ...user,
    projects: user.projectIds.map((id) =&gt; get(state`projects.${id}`)
  }
})</code></pre><p>And then you can choose what to grab in different components.</p><pre><code class="language-js">// I only want the user
connect({
  user: user(props`userKey`)
})
// I want the user with projects
connect({
  user: compute(user(props`userKey`), userProjects)
})</code></pre><p>So compute is a very powerful tool. It is up to the project and your preferences to use what makes most sense. Maybe you just need to use a simple computed, or maybe you need to take it up a notch and compose. Or maybe you do not even need compute at all and can just use tags.</p></div></div></div><div class="docs-footer"><div class="docs-footer-column"><div class="docs-footer-header">ORGANIZATION</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral/graphs/contributors" target="_new">Contributors</a><a class="docs-footer-link" href="http://www.webpackbin.com" target="_new">www.webpackbin.com</a><a class="docs-footer-link" href="http://www.christianalfoni.com" target="_new">www.christianalfoni.com</a></div><div class="docs-footer-column"><div class="docs-footer-header">ARTICLES AND USEFUL LINKS</div><a class="docs-footer-link" href="http://medium.com/p/5793c08db2cc" target="_new">The story of Cerebral</a><a class="docs-footer-link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730" target="_new">An unlikely success story</a></div><div class="docs-footer-column"><div class="docs-footer-header">HELP</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral" target="_new">Cerebral github repo</a><a class="docs-footer-link" href="https://discord.gg/0kIweV4bd2bwwsvH" target="_new">Discoard chat</a></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/scroll-detect.js"></script>
  </body>
</html>
