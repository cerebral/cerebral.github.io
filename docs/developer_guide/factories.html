<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/favicons/manifest.json">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div class="beta">beta</div><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><a href="/docs/get_started">get started</a><div class="underline"></div></li><li class="docs-navigation-item active"><a href="/docs/developer_guide">developer guide</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/packages">packages</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/migration">migration</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a><a href="http://cerebral-website.herokuapp.com/" class="docs-icon" target="_new" style="color:#DD4A68;">old website</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger">☰</div><div class="docs-navigation-title mobile">developer guide</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item mobile"><a href="/docs/get_started">get started</a></li><li class="docs-navigation-item active mobile"><a href="/docs/developer_guide">developer guide</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/developer_guide/index.html">Introduction</a></li><li><a href="/docs/developer_guide/state.html">State</a></li><li><a href="/docs/developer_guide/connect.html">Components</a></li><li><a href="/docs/developer_guide/signals.html">Signals</a></li><li><a href="/docs/developer_guide/actions.html">Actions</a></li><li><a href="/docs/developer_guide/operators.html">Operators</a></li><li class="active"><a href="/docs/developer_guide/factories.html">Factories</a><ul><li><a href="#action-factory">Action factory</a></li><li><a href="#actions-sequence-factory">Actions sequence factory</a></li><li><a href="#tutorial">Tutorial</a></li></ul></li><li><a href="/docs/developer_guide/paths.html">Paths</a></li><li><a href="/docs/developer_guide/compute.html">Compute</a></li><li><a href="/docs/developer_guide/routing.html">Routing</a></li><li><a href="/docs/developer_guide/organize.html">Organize</a></li><li><a href="/docs/developer_guide/providers.html">Providers</a></li><li><a href="/docs/developer_guide/test.html">Test</a></li><li><a href="/docs/developer_guide/collaborate.html">Collaborate</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/packages">packages</a></li><li class="docs-navigation-item mobile"><a href="/docs/migration">migration</a></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/developer_guide/index.html">Introduction</a></li><li><a href="/docs/developer_guide/state.html">State</a></li><li><a href="/docs/developer_guide/connect.html">Components</a></li><li><a href="/docs/developer_guide/signals.html">Signals</a></li><li><a href="/docs/developer_guide/actions.html">Actions</a></li><li><a href="/docs/developer_guide/operators.html">Operators</a></li><li class="active"><a href="/docs/developer_guide/factories.html">Factories</a><ul><li><a href="#action-factory">Action factory</a></li><li><a href="#actions-sequence-factory">Actions sequence factory</a></li><li><a href="#tutorial">Tutorial</a></li></ul></li><li><a href="/docs/developer_guide/paths.html">Paths</a></li><li><a href="/docs/developer_guide/compute.html">Compute</a></li><li><a href="/docs/developer_guide/routing.html">Routing</a></li><li><a href="/docs/developer_guide/organize.html">Organize</a></li><li><a href="/docs/developer_guide/providers.html">Providers</a></li><li><a href="/docs/developer_guide/test.html">Test</a></li><li><a href="/docs/developer_guide/collaborate.html">Collaborate</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/developer_guide/factories.md" target="_new">Edit on Github</a></div><h1 id="factories">Factories</h1><p>Function factories is a common term in programming. It is basically a function that returns a function:</p><pre><code class="language-js">function createHelloMessage (name) {
  function helloMessage () {
    console.log(`Hello there ${name}`)
  }

  return helloMessage
}

const helloBob = createHelloMessage(&#x27;Bob&#x27;)
helloBob() // Logs: &quot;Hello there Bob&quot;</code></pre><p>In Cerebral you will find yourself creating a lot of factories. Factories for creating actions and even factories for creating sequences of actions. Actually the Cerebral <strong>operators</strong> are action and actions sequence factories.</p><h2 id="action-factory">Action factory</h2><pre><code class="language-js">function hasUserRoleFactory (role) {
  function hasUserRole ({state, path}) {
    if (state.get(&#x27;user.role&#x27;) === role) {
      return path.true()
    }

    return path.false()
  }

  return hasUserRole
}</code></pre><p>So this factory can now be used in any sequence:</p><pre><code class="language-js">import hasUserRole from &#x27;../factories/hasUserRole&#x27;

export default [
  hasUserRole(&#x27;admin&#x27;), {
    true: [],
    false: []
  }
]</code></pre><h2 id="actions-sequence-factory">Actions sequence factory</h2><pre><code class="language-js">import {set, wait} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

function showMessageFactory (message, ms) {
  return [
    set(state`app.message`, message),
    wait(ms),
    set(state`app.message`, null)
  ]
}</code></pre><p>Now this can be used in any other sequence of actions:</p><pre><code class="language-js">import showMessage from &#x27;../factories/showMessage&#x27;

function someAction () {}

export default [
  someAction,
  showMessage(&#x27;Hello there!&#x27;, 500)
]</code></pre><h2 id="tutorial">Tutorial</h2><p><strong>Before you start,</strong> <a href="https://www.webpackbin.com/bins/-KfHVlMgu-OTENr2fH2-" target="new">load this BIN on Webpackbin</a></p><p>To see how <strong>factories</strong> are defined you may also check out the already existing code inside cerebral itself.
E.g. that is how the <strong>wait</strong> operator looks like:</p><pre><code class="language-js">function waitFactory (ms) {
  function wait () {
    return new Promise((resolve) =&gt; {
      setTimeout(resolve, ms)
    })
  }

  return wait
}</code></pre><p>You can see that a <strong>factory</strong> is just a function that returns another function which we call <strong>action</strong>. The action itself (wait) returns a promise. This promise is what tells the signal to hold its execution until it is resolved. Because <strong>wait</strong> is quite a common operation it’s already included as an operator in the default</p><p>Let us create our own custom <strong>showToast</strong> factory. It will return a sequence of actions. As you can see we have moved the operators we defined previously into this array, using the arguments passed into the factory. As an example we want to name this sequence of actions, so instead of using an array we rather use the <strong>sequence</strong> function. They are exactly the same, only the function allows us to pass in a name as the first argument:</p><pre><code class="language-js">import {Controller, sequence} from &#x27;cerebral&#x27;
...
function showToast(message, ms) {
  return sequence(&#x27;showToast&#x27;, [
    set(state`toast`, message),
    wait(ms),
    set(state`toast`, null)
  ])
}
...
const controller = Controller(...)</code></pre><p>We need to adjust the signal as well:</p><pre><code class="language-js">Controller({
  signals: {
    buttonClicked: [
      showToast(props`message`, 1000)
    ]
  }
})</code></pre><p>When this now triggers you will see in the debugger the <strong>showToast</strong> sequence composed into our signal definition and it is even named. This is a good practice for very complex flows, but not strictly necessary. Using plain arrays will get you very far.</p><p>Congratulations! You have successfully mastered the power of factories. But there are a couple of more concepts that will help you define state changes, jump over to the next chapter to find out more.</p><p>If it did not work try jumping to the next chapter or <a href="https://discord.gg/0kIweV4bd2bwwsvH" target="new">shout at us on Discord</a>.</p></div></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
