<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/favicons/manifest.json">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div class="beta">beta</div><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><a href="/docs/get_started">get started</a><div class="underline"></div></li><li class="docs-navigation-item active"><a href="/docs/developer_guide">developer guide</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/packages">packages</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/migration">migration</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a><a href="http://cerebral-website.herokuapp.com/" class="docs-icon" target="_new" style="color:#DD4A68;">old website</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger"></div><div class="docs-navigation-title mobile">developer guide</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item mobile"><a href="/docs/get_started">get started</a></li><li class="docs-navigation-item active mobile"><a href="/docs/developer_guide">developer guide</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/developer_guide/index.html">Introduction</a></li><li><a href="/docs/developer_guide/state.html">State</a></li><li><a href="/docs/developer_guide/connect.html">Components</a></li><li><a href="/docs/developer_guide/signals.html">Signals</a></li><li><a href="/docs/developer_guide/actions.html">Actions</a></li><li><a href="/docs/developer_guide/operators.html">Operators</a></li><li><a href="/docs/developer_guide/factories.html">Factories</a></li><li class="active"><a href="/docs/developer_guide/paths.html">Paths</a><ul><li><a href="#tutorial">Tutorial</a><ul><li><a href="#http-provider">Http Provider</a></li><li><a href="#grabbing-a-repo">Grabbing a repo</a></li><li><a href="#parallel-execution">Parallel execution</a></li><li><a href="#handling-time">Handling time</a></li><li><a href="#challenge">Challenge</a></li></ul></li></ul></li><li><a href="/docs/developer_guide/compute.html">Compute</a></li><li><a href="/docs/developer_guide/routing.html">Routing</a></li><li><a href="/docs/developer_guide/organize.html">Organize</a></li><li><a href="/docs/developer_guide/providers.html">Providers</a></li><li><a href="/docs/developer_guide/errors.html">Errors</a></li><li><a href="/docs/developer_guide/test.html">Test</a></li><li><a href="/docs/developer_guide/collaborate.html">Collaborate</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/packages">packages</a></li><li class="docs-navigation-item mobile"><a href="/docs/migration">migration</a></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/developer_guide/index.html">Introduction</a></li><li><a href="/docs/developer_guide/state.html">State</a></li><li><a href="/docs/developer_guide/connect.html">Components</a></li><li><a href="/docs/developer_guide/signals.html">Signals</a></li><li><a href="/docs/developer_guide/actions.html">Actions</a></li><li><a href="/docs/developer_guide/operators.html">Operators</a></li><li><a href="/docs/developer_guide/factories.html">Factories</a></li><li class="active"><a href="/docs/developer_guide/paths.html">Paths</a><ul><li><a href="#tutorial">Tutorial</a><ul><li><a href="#http-provider">Http Provider</a></li><li><a href="#grabbing-a-repo">Grabbing a repo</a></li><li><a href="#parallel-execution">Parallel execution</a></li><li><a href="#handling-time">Handling time</a></li><li><a href="#challenge">Challenge</a></li></ul></li></ul></li><li><a href="/docs/developer_guide/compute.html">Compute</a></li><li><a href="/docs/developer_guide/routing.html">Routing</a></li><li><a href="/docs/developer_guide/organize.html">Organize</a></li><li><a href="/docs/developer_guide/providers.html">Providers</a></li><li><a href="/docs/developer_guide/errors.html">Errors</a></li><li><a href="/docs/developer_guide/test.html">Test</a></li><li><a href="/docs/developer_guide/collaborate.html">Collaborate</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/developer_guide/paths.md" target="_new">Edit on Github</a></div><h1 id="paths">Paths</h1><p>Signals can also express execution paths. For example:</p><pre><code class="language-js">function actionA () {}
function actionB () {}
function actionC () {}

export default [
  actionA, {
    foo: actionB,
    bar: actionC
  }
]</code></pre><p>When an object is expressed after an action we call that object the paths of the action. The context of the action will have <strong>path</strong> available on its context. For example in this example:</p><pre><code class="language-js">function actionA ({path}) {
  path.foo // function
  path.bar // function
}</code></pre><p>When the action calls and returns one of these paths, that path will be executed:</p><pre><code class="language-js">function actionA ({path}) {
  return path.foo()
}</code></pre><p>This is possible due to Cerebrals static analysis of the signals. It knows exactly how it is going to run before it is executed.</p><p>You can also pass a payload to the path:</p><pre><code class="language-js">function actionA ({path}) {
  return path.foo({
    foo: &#x27;bar&#x27;
  })
}</code></pre><p>This is merged into the <em>props</em> and made available to the next actions. If you return a promise from an action you just resolve the path:</p><pre><code class="language-js">function actionA ({path}) {
  return new Promise((resolve) =&gt; {
    resolve(path.foo({
      foo: &#x27;bar&#x27;
    }))
  })
}</code></pre><h2 id="tutorial">Tutorial</h2><p><strong>Before you start,</strong> <a href="https://www.webpackbin.com/bins/-KdBUBNJyrfqL3c6VHkr" target="new">load this BIN on Webpackbin</a></p><p>In the previous chapter we introduced async actions. But what about the following scenario: “User gets data async from a server, server responds with either a success or error”. To handle not only the so called <em>Happy Path</em> we should also allow our signals to branch out into a different flows depending on the result of the previous action.</p><h3 id="http-provider">Http Provider</h3><p>So let us build that scenario introducing <em>cerebral-http-provider</em>. <em>cerebral-http-provider</em> is a simple http-provider which enables you to request data from servers. You could have used any other HTTP library if you wanted to. We have already added it as a configuration of the controller. The concept of <strong>Providers</strong> will be covered in more detail in one of the next chapters.</p><p>To handle any kind of diverging execution in a signal we can use the concept of <strong>paths</strong>. A simple signal using paths and a sample async action named <em>getData</em> could look like this:</p><pre><code class="language-js">Controller({
  signals: {
    submitClicked:[
      getData, {
        success:[
          processResults,
          showSuccessMessage
        ],
        error: showErrorMessage
      }
    ]
  }
})</code></pre><p>Where <em>success</em> and <em>error</em> are our <strong>paths</strong>.</p><h3 id="grabbing-a-repo">Grabbing a repo</h3><p>Let us implement something similar. We are going to grab information about github repos and display it in the toast. We introduce a new tag called <strong>string</strong>. It just evaluates the string, inserting any props or state you have defined in it. So please change your <em>controller.js</em> to also contain:</p><pre><code class="language-js">...
import {set, wait} from &#x27;cerebral/operators&#x27;
import {state, props, string} from &#x27;cerebral/tags&#x27;
...
{
  buttonClicked: [
    showToast(string`Loading data for repo: ${props`repo`}`, 2000),
    getRepo, {
      success: showToast(
        string`
          How cool is that. ${props`repo`}
          has ${props`result.subscribers_count`}
          subscribers and ${props`result.stargazers_count`}
          stars!
        `,
        5000
      ),
      error: showToast(
        string`
          Ooops something went wrong: ${props`error`}
        `,
        5000
      )
    }
  ]
}
...</code></pre><p>As you can see you can configure as many and whatever paths you like. Just add an object after an action and the action will know about possible paths to execute.</p><p>Also notice here that we plan our signal before implementing. Typically working in a team you would actually define the signal first and later implement the actions. It is the flow that is important to get right.</p><p>The <strong>getRepo</strong> action can look like this:</p><pre><code class="language-js">...
function getRepo({props, http, path}) {
  return http.get(`/repos/cerebral/${props.repo}`)
    .then(path.success)
    .catch(path.error)
}

const controller = Controller(...)</code></pre><p>The path <strong>success</strong> and <strong>error</strong> are now available inside the action because we defined those paths after the action in the chain. When either <strong>.then</strong> or <strong>.catch</strong> resolves it will call the path function and return it. Last, but not least, we need to pass in a <strong>repo</strong> property on our button click:</p><p><em>App.js</em></p><pre><code class="language-js">...
&lt;button onClick={() =&gt; buttonClicked({repo: &#x27;cerebral&#x27;})}&gt;
  Update state
&lt;/button&gt;
...</code></pre><h3 id="parallel-execution">Parallel execution</h3><p>But there is an issue here. Did you notice that the message <em>Loading data for repo…</em> is blocking the execution for 2 seconds? It would be nice to indicate to Cerebral that actions can execute in parallel.</p><p>Replace your signal with the following snippet:</p><pre><code class="language-js">...
import {Controller, sequence, parallel} from &#x27;cerebral&#x27;
...

{
  buttonClicked: parallel([
    showToast(string`Loading data for repo: ${props`repo`}`, 2000),
    getRepo, {
      success: showToast(
        string`How cool is that. ${props`repo`}
         has ${props`result.subscribers_count`}
         subscribers and ${props`result.stargazers_count`}
         stars!
        `,
        5000,
        &#x27;success&#x27;
      ),
      error: showToast(
        string`
          Ooops something went wrong: ${props`result.message`}
        `,
        5000,
        &#x27;error&#x27;
      )
    }
  ])
}</code></pre><p>What is happening here? Did you spot the use of <strong>parallel</strong>? This is just like defining a sequence of actions only that the next action will run immediately, even though the previous one returned a Promise.</p><p>We got even more flow control now, telling Cerebral to execute actions/operators in parallel and objects to diverge execution. By reading the signals you get a good understanding what the application will do. And don’t forget, you do not even have to look at the code to understand this, the debugger reflects parallel execution, state changes, and even <strong>paths</strong> chosen.</p><h3 id="handling-time">Handling time</h3><p>But… there is an other issue here. Did you notice that these <strong>showToast</strong> action factories do not cancel each other out? So the initial 2 second wait might close the toast where it was supposed to hold for 5 seconds after a success?</p><p>Instead of using <strong>wait</strong>, we can use <strong>debounce</strong>. It is difficult to wrap your head around debounce. Simply said it ensures that whenever we run <strong>showToast</strong>, any pending toast timer will be discarded. But that is not enough, cause we have multiple <em>showToast</em> in our signal. So we need this behavior to be shared across them. Whenever <strong>any</strong> <em>showToast</em> is called, we want the existing pending toast timer to be discarded. We can do that by creating a shared debounce. So once again, head over to <em>controller.js</em> and change it to:</p><pre><code class="language-js">...
import {set, merge, debounce} from &#x27;cerebral/operators&#x27;
import {state, props, string} from &#x27;cerebral/tags&#x27;
...
const toastDebounce = debounce.shared()
function showToast (message, ms) {
  return sequence(&#x27;showToast&#x27;, [
    set(state`toast`, message),
    toastDebounce(ms), {
      continue: [
        set(state`toast`, null)
      ],
      discard: []
    }
  ])
}
...</code></pre><p>Congratulations! Now you know how to control your flow using <strong>paths</strong>. And if you need <strong>parallel actions/operators</strong>, well just use the <strong>parallel</strong> function. You have even gotten insight into very complex control flow using <strong>debounce</strong>.</p><h3 id="challenge">Challenge</h3><p>We would like you to run two getRepo(…) requests. One to <em>cerebral/cerebral</em> and one to <em>cerebral/addressbar</em>. So it is a good idea to make <em>getRepo</em> a factory instead. On their successes, they should insert their data into the state tree.</p><p>If it did not work try jumping to the next chapter or <a href="https://discord.gg/0kIweV4bd2bwwsvH" target="new">shout at us on Discord</a>.</p></div></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
