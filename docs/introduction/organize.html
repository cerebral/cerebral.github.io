<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/favicons/manifest.json">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div class="beta">beta</div><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item active"><a href="/docs/introduction">introduction</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/addons">addons</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/resources">resources</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a><a href="http://cerebral-website.herokuapp.com/" class="docs-icon" target="_new" style="color:#DD4A68;">old website</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger"></div><div class="docs-navigation-title mobile">introduction</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item active mobile"><a href="/docs/introduction">introduction</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/introduction/index.html">What is Cerebral?</a></li><li><a href="/docs/introduction/the_architecture.html">The architecture</a></li><li><a href="/docs/introduction/install.html">Install</a></li><li><a href="/docs/introduction/debugger.html">Debugger</a></li><li><a href="/docs/introduction/state.html">State</a></li><li><a href="/docs/introduction/components.html">Components</a></li><li><a href="/docs/introduction/signals.html">Signals</a></li><li><a href="/docs/introduction/actions.html">Actions</a></li><li><a href="/docs/introduction/operators.html">Operators</a></li><li><a href="/docs/introduction/factories.html">Factories</a></li><li><a href="/docs/introduction/paths.html">Paths</a></li><li><a href="/docs/introduction/compute.html">Compute</a></li><li><a href="/docs/introduction/routing.html">Routing</a></li><li class="active"><a href="/docs/introduction/organize.html">Organize</a><ul><li><a href="#components">Components</a></li><li><a href="#tutorial">Tutorial</a><ul><li><a href="#folder-structure">Folder structure</a></li><li><a href="#main.js">main.js</a></li><li><a href="#controller.js">controller.js</a></li><li><a href="#modules/app">modules/app</a></li><li><a href="#modules/home">modules/home</a></li><li><a href="#modules/repos">modules/repos</a></li><li><a href="#components/app">components/App</a></li><li><a href="#finish-the-refactor">Finish the refactor</a></li></ul></li></ul></li><li><a href="/docs/introduction/providers.html">Providers</a></li><li><a href="/docs/introduction/errors.html">Errors</a></li><li><a href="/docs/introduction/test.html">Test</a></li><li><a href="/docs/introduction/production.html">Production</a></li><li><a href="/docs/introduction/collaborate.html">Collaborate</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li><li class="docs-navigation-item mobile"><a href="/docs/addons">addons</a></li><li class="docs-navigation-item mobile"><a href="/docs/resources">resources</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/introduction/index.html">What is Cerebral?</a></li><li><a href="/docs/introduction/the_architecture.html">The architecture</a></li><li><a href="/docs/introduction/install.html">Install</a></li><li><a href="/docs/introduction/debugger.html">Debugger</a></li><li><a href="/docs/introduction/state.html">State</a></li><li><a href="/docs/introduction/components.html">Components</a></li><li><a href="/docs/introduction/signals.html">Signals</a></li><li><a href="/docs/introduction/actions.html">Actions</a></li><li><a href="/docs/introduction/operators.html">Operators</a></li><li><a href="/docs/introduction/factories.html">Factories</a></li><li><a href="/docs/introduction/paths.html">Paths</a></li><li><a href="/docs/introduction/compute.html">Compute</a></li><li><a href="/docs/introduction/routing.html">Routing</a></li><li class="active"><a href="/docs/introduction/organize.html">Organize</a><ul><li><a href="#components">Components</a></li><li><a href="#tutorial">Tutorial</a><ul><li><a href="#folder-structure">Folder structure</a></li><li><a href="#main.js">main.js</a></li><li><a href="#controller.js">controller.js</a></li><li><a href="#modules/app">modules/app</a></li><li><a href="#modules/home">modules/home</a></li><li><a href="#modules/repos">modules/repos</a></li><li><a href="#components/app">components/App</a></li><li><a href="#finish-the-refactor">Finish the refactor</a></li></ul></li></ul></li><li><a href="/docs/introduction/providers.html">Providers</a></li><li><a href="/docs/introduction/errors.html">Errors</a></li><li><a href="/docs/introduction/test.html">Test</a></li><li><a href="/docs/introduction/production.html">Production</a></li><li><a href="/docs/introduction/collaborate.html">Collaborate</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/introduction/organize.md" target="_new">Edit on Github</a></div><h1 id="organize">Organize</h1><p>Cerebral uses a concept called <strong>modules</strong> to organize application code. These allow you to wrap state and signals into a namespace without isolating them. Any action run in a signal can change any state in the application.</p><p>Typically the file structure for modules looks like this. We call it the <strong>signals pattern</strong>. Every signal has its own file.</p><pre class="language-js"><code class="language-js">/modules
  /home
    /actions
    /signals
    index.js
main.js</code></pre><p>The <strong>index.js</strong> file is where you define the module. It is just an object where you can define state, signals and optionally sub modules.</p><pre class="language-js"><code class="language-js">import somethingHappened from &#x27;./signals/somethingHappened&#x27;

export default {
  state: {},
  signals: {
    somethingHappened
  }
}</code></pre><p>You are free to structure however you want of course. Maybe you rather want to define signals directly in <em>index.js</em>, rather than have each one contained in a file.</p><p>In the <strong>controller.js</strong> file, the module is added to the controller:</p><pre class="language-js"><code class="language-js">import {Controller} from &#x27;cerebral&#x27;
import home from &#x27;./modules/home&#x27;

const controller = Controller({
  modules: {
    home
  }
})</code></pre><p>Any signal and state defined inside the <em>home</em> module will live on the namespace chosen during controller instantiation.</p><p>And this is how an application scales: by defining modules and submodules. Actions and factories that are common are often placed in a folder called <strong>common</strong>:</p><pre class="language-js"><code class="language-js">/common
  /actions
  /factories
/modules
  /home
    /actions
    /signals
    index.js
main.js</code></pre><h2 id="components">Components</h2><p>A very important point in Cerebral is that your components do not affect the structure of the application state. Modules are defined in terms of what makes sense for state and signals. Sometimes this is similar to how components are structured, but more often it is not. This is why components usually live in their own <strong>components</strong> folder, separated from the modules:</p><pre class="language-js"><code class="language-js">/components
  /Home
    index.js
/common
  /actions
  /factories
/modules
  /home
    /actions
    /signals
    index.js
main.js</code></pre><p>And this is it. You will never get in trouble creating a module because any action can change any state in your application. Modules are just a way to structure state and signals, not isolate them.</p><h2 id="tutorial">Tutorial</h2><p>Before we begin you can have a look at <a href="https://www.webpackbin.com/bins/-KfDKApROapTmuhEF5_j" target="new">the solution over here</a>. Click the <strong>download</strong> button, which downloads the project as a Webpack project, extract the contents to a folder on your computer and make sure that you have installed <a href="https://nodejs.org/en/" target="new">Node JS</a>. From the command line, run:</p><p><code>npm install</code></p><p>Then you can run:</p><p><code>npm start</code></p><p>Go to <em>localhost:3000</em> in your browser. Now you have a starting point for playing more with Cerebral and make the final adjustments yourself. A new Webpack loader called <strong>CSS Modules</strong> has been added and also the <strong>classnames</strong> tool is ready to be used. These two features allows you to refactor the CSS of the application in a scalable way.</p><h3 id="folder-structure">Folder structure</h3><p>SO! Welcome to the world of <strong>modules</strong>. We will build the following structure:</p><pre class="language-undefined"><code class="language-undefined">/src
  /components
    /App
      index.js
      styles.css
    /Home
      index.js
      styles.css
    /Repos
      index.js
      styles.css
    /Toast
      index.js
      styles.css

  /modules
    /app
      /factories
        showToast.js
      index.js
    /home
      /signals
        routed.js
      index.js
    /repos
      /factories
        getRepo.js
      /signals
        routed.js
      index.js

  /computed
    starsCount.js

  controller.js
  main.js</code></pre><p>Let us do this step by step.</p><h3 id="main.js">main.js</h3><p>Our main file should just wire things together, meaning that it wires the controller with the view.</p><pre class="language-js"><code class="language-js">import React from &#x27;react&#x27;
import {render} from &#x27;react-dom&#x27;
import {Container} from &#x27;cerebral/react&#x27;
import controller from &#x27;./controller&#x27;
import App from &#x27;./components/App&#x27;

render((
  &lt;Container controller={controller}&gt;
    &lt;App /&gt;
  &lt;/Container&gt;
), document.querySelector(&#x27;#app&#x27;))</code></pre><h3 id="controller.js">controller.js</h3><p>Our controller does the same kind of wiring. It wires the modules of our app to the controller and its configuration.</p><pre class="language-js"><code class="language-js">import {Controller} from &#x27;cerebral&#x27;
import Devtools from &#x27;cerebral/devtools&#x27;
import Router from &#x27;@cerebral/router&#x27;
import HttpProvider from &#x27;@cerebral/http&#x27;
import app from &#x27;./modules/app&#x27;
import home from &#x27;./modules/home&#x27;
import repos from &#x27;./modules/repos&#x27;

const controller = Controller({
  devtools: Devtools({
    host: &#x27;127.0.0.1:8585&#x27;
  }),
  modules: {
    app,
    home,
    repos,
    router: Router({
      routes: [
        {path: &#x27;/&#x27;, signal: &#x27;home.routed&#x27;},
        {path: &#x27;/repos&#x27;, signal: &#x27;repos.routed&#x27;}
      ],
      onlyHash: true
    })
  },
  providers: [
    HttpProvider({
      baseUrl: &#x27;https://api.github.com&#x27;
    })
  ]
})</code></pre><p>Basically our state and signals has been removed and we rather import modules instead.</p><h3 id="modules/app">modules/app</h3><p>The app module will take care of what tab is currently active, our titles and the toast.</p><p><em>index.js</em></p><pre class="language-js"><code class="language-js">export default {
  state: {
    title: &#x27;Cerebral Tutorial&#x27;,
    subTitle: &#x27;Routing&#x27;,
    activeTab: &#x27;home&#x27;,
    toast: null
  }
}</code></pre><p>It will also hold the <strong>showToast</strong> factory as we consider it a “global app thing”, even though it is currently only used by the <strong>repos</strong> module.</p><p><em>factories/showToast.js</em></p><pre class="language-js"><code class="language-js">import {set, merge, debounce} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

const toastDebounce = debounce.shared()
function showToast (message, ms, type = null) {
  if (!ms) {
    return merge(state`app.toast`, {message, type})
  }

  return [
    merge(state`app.toast`, {message, type}),
    toastDebounce(ms), {
      continue: [
        set(state`app.toast`, null)
      ],
      discard: []
    }
  ]
}

export default showToast</code></pre><p>Note that the paths to the state has changed, since <strong>toast</strong> now is under the namespace <strong>app</strong>.</p><h3 id="modules/home">modules/home</h3><p>The home module does not have any state, but it does have a signal related to being clicked.</p><p><em>index.js</em></p><pre class="language-js"><code class="language-js">import clicked from &#x27;./signals/clicked&#x27;

export default {
  signals: {
    clicked
  }
}</code></pre><p><em>signals/clicked.js</em></p><pre class="language-js"><code class="language-js">import {set} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default set(state`app.activeTab`, &#x27;home&#x27;)</code></pre><p>As you can see any signal can point to any state. This allows you to organize your app in a way that makes sense without worrying about isolation. This is really important, because in complex applications isolation causes big challenges.</p><h3 id="modules/repos">modules/repos</h3><p>Our repos module holds the list of repos and also holds the signal for opening the repos tab.</p><p><em>index.js</em></p><pre class="language-js"><code class="language-js">import clicked from &#x27;./signals/clicked&#x27;

export default {
  state: {
    list: {}
  },
  signals: {
    clicked
  }
}</code></pre><p><em>signals/clicked.js</em></p><pre class="language-js"><code class="language-js">import {parallel} from &#x27;cerebral&#x27;
import {set, when} from &#x27;cerebral/operators&#x27;
import {state, props, string} from &#x27;cerebral/tags&#x27;
import getRepo from &#x27;../factories/getRepo&#x27;
import showToast from &#x27;../../app/factories/showToast&#x27;
import starsCount from &#x27;../../computed/starsCount&#x27;

export default [
  set(state`app.activeTab`, &#x27;repos&#x27;),
  showToast(string`Loading data for repos...`),
  parallel([
    getRepo(&#x27;cerebral&#x27;),
    getRepo(&#x27;addressbar&#x27;)
  ]),
  when(props`error`), {
    &#x27;true&#x27;: showToast(string`Error: ${props`error`}`, 5000, &#x27;error&#x27;),
    &#x27;false&#x27;: [
      set(state`repos.list.cerebral`, props`cerebral`),
      set(state`repos.list.addressbar`, props`addressbar`),
      showToast(string`The repos have ${starsCount} stars`, 5000, &#x27;success&#x27;)    
    ]
  }
]</code></pre><p><em>factories/getRepo.js</em></p><pre class="language-js"><code class="language-js">function getRepoFactory (repoName) {
  function getRepo ({http}) {
    return http.get(`/repos/cerebral/${repoName}`)
      .then((response) =&gt; {
        return {[repoName]: response.result}
      })
      .catch((response) =&gt; {
        return {error: response.error}
      })
  }

  return getRepo
}

export default getRepoFactory</code></pre><p>This is a good example of how Cerebral works. Note that there are no imports to this action factory. You just write out the logic of it, cause the context is decoupled from the actual logic.</p><h3 id="components/app">components/App</h3><p>We also need to split up our components a bit. The app component is now cleaned up a bit and it is using <strong>CSS Modules</strong> and the <strong>classnames</strong> tool.</p><p><em>index.js</em></p><pre class="language-js"><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;
import styles from &#x27;./styles.css&#x27;
import classnames from &#x27;classnames&#x27;
import Toast from &#x27;./Toast&#x27;
import Home from &#x27;../Home&#x27;
import Repos from &#x27;../Repos&#x27;

export default connect({
  title: state`app.title`,
  subTitle: state`app.subTitle`,
  activeTab: state`app.activeTab`,
  homeClicked: signal`home.clicked`,
  reposClicked: signal`repos.clicked`
},
  function App ({
    title,
    subTitle,
    activeTab,
    homeClicked,
    reposClicked
  }) {
    return (
      &lt;div&gt;
        &lt;h1 className={styles.center}&gt;{title}&lt;/h1&gt;
        &lt;h2 className={styles.center}&gt;{subTitle}&lt;/h2&gt;
        &lt;div&gt;
          &lt;div className={styles.tabs}&gt;
            &lt;div
              onClick={() =&gt; homeClicked()}
              className={classnames(styles.tab, {
                [styles.activeTab]: activeTab === &#x27;home&#x27;
              })}
            &gt;
              Home
            &lt;/div&gt;
            &lt;div
              onClick={() =&gt; reposClicked()}
              className={classnames(styles.tab, {
                [styles.activeTab]: activeTab === &#x27;repos&#x27;
              })}
            &gt;
              Repos
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;br /&gt;
          {activeTab === &#x27;home&#x27; ? &lt;Home /&gt; : null}
          {activeTab === &#x27;repos&#x27; ? &lt;Repos /&gt; : null}
        &lt;/div&gt;
        &lt;Toast /&gt;
      &lt;/div&gt;
    )
  }
)</code></pre><p>Note here how css class names are actually being exported as a module to the component file. Allowing it to point to these classes with plain JavaScript. That is what css modules is all about and they are great for keeping you sane writing CSS in large applications. Lets look at how to refactor the css file:</p><p><em>styles.css</em></p><pre class="language-css"><code class="language-css">.center {
  text-align: center;
}

.tabs {
  display: flex;
}

.tab {
  flex: 1;
  font-size: 18px;
  cursor: pointer;
  text-align: center;
  padding: 5px;
}

.activeTab {
  background-color: #0086b3;
  border-radius: 3px;
  color: #FFF;
}</code></pre><h3 id="finish-the-refactor">Finish the refactor</h3><p>We have shown you the idea of the refactor here and now you can finish it. You need to refactor the following:</p><ol><li>Home component and styles (if any)</li><li>Repos component and styles</li><li>starsCount computed</li></ol><p>And some notes:</p><ol><li>Remember to changes paths to signals and state, they are now namespaced. For example: <strong>repos.list</strong> instead of <strong>repos</strong></li><li>There should not be any <strong>styles.css</strong> file linked to in <strong>index.html</strong>. All CSS should be related to a specific component</li></ol><p>Congratulations! You have reached the end of our <em>Get Started</em> - tutorial.
There is a lot of other good stuff on this website. So please check it out!</p><p>When you are done with the refactor you can try to create a form input where on <strong>onSubmit</strong> it will fetch that repo and show its stars count. Remember to <strong>preventDefault</strong> on the form submit event! :)</p><p>Build your next big thing with <strong>Cerebral</strong> and please tell us about it on <a href="https://discord.gg/0kIweV4bd2bwwsvH" target="new">discord chat</a> :)</p></div></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
