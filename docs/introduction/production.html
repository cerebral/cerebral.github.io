<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/favicons/manifest.json">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div class="beta">beta</div><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item active"><a href="/docs/introduction">introduction</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/addons">addons</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/resources">resources</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a><a href="http://cerebral-website.herokuapp.com/" class="docs-icon" target="_new" style="color:#DD4A68;">old website</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger"></div><div class="docs-navigation-title mobile">introduction</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item active mobile"><a href="/docs/introduction">introduction</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/introduction/index.html">What is Cerebral?</a></li><li><a href="/docs/introduction/the_architecture.html">The architecture</a></li><li><a href="/docs/introduction/install.html">Install</a></li><li><a href="/docs/introduction/debugger.html">Debugger</a></li><li><a href="/docs/introduction/state.html">State</a></li><li><a href="/docs/introduction/components.html">Components</a></li><li><a href="/docs/introduction/signals.html">Signals</a></li><li><a href="/docs/introduction/actions.html">Actions</a></li><li><a href="/docs/introduction/operators.html">Operators</a></li><li><a href="/docs/introduction/factories.html">Factories</a></li><li><a href="/docs/introduction/paths.html">Paths</a></li><li><a href="/docs/introduction/compute.html">Compute</a></li><li><a href="/docs/introduction/routing.html">Routing</a></li><li><a href="/docs/introduction/organize.html">Organize</a></li><li><a href="/docs/introduction/providers.html">Providers</a></li><li><a href="/docs/introduction/errors.html">Errors</a></li><li><a href="/docs/introduction/test.html">Test</a></li><li class="active"><a href="/docs/introduction/production.html">Production</a><ul><li><a href="#lazy-loading">Lazy loading</a></li></ul></li><li><a href="/docs/introduction/collaborate.html">Collaborate</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li><li class="docs-navigation-item mobile"><a href="/docs/addons">addons</a></li><li class="docs-navigation-item mobile"><a href="/docs/resources">resources</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/introduction/index.html">What is Cerebral?</a></li><li><a href="/docs/introduction/the_architecture.html">The architecture</a></li><li><a href="/docs/introduction/install.html">Install</a></li><li><a href="/docs/introduction/debugger.html">Debugger</a></li><li><a href="/docs/introduction/state.html">State</a></li><li><a href="/docs/introduction/components.html">Components</a></li><li><a href="/docs/introduction/signals.html">Signals</a></li><li><a href="/docs/introduction/actions.html">Actions</a></li><li><a href="/docs/introduction/operators.html">Operators</a></li><li><a href="/docs/introduction/factories.html">Factories</a></li><li><a href="/docs/introduction/paths.html">Paths</a></li><li><a href="/docs/introduction/compute.html">Compute</a></li><li><a href="/docs/introduction/routing.html">Routing</a></li><li><a href="/docs/introduction/organize.html">Organize</a></li><li><a href="/docs/introduction/providers.html">Providers</a></li><li><a href="/docs/introduction/errors.html">Errors</a></li><li><a href="/docs/introduction/test.html">Test</a></li><li class="active"><a href="/docs/introduction/production.html">Production</a><ul><li><a href="#lazy-loading">Lazy loading</a></li></ul></li><li><a href="/docs/introduction/collaborate.html">Collaborate</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/introduction/production.md" target="_new">Edit on Github</a></div><h1 id="production">Production</h1><p>It is recommended to use <a href="https://webpack.js.org/" target="new">Webpack</a> to bundle your application. This is a minimal Webpack config for production to help you reduce the bundle size as much as possible. Make sure you always set <strong>NODE_ENV=production</strong> when you bundle for production:</p><pre class="language-js"><code class="language-js">const webpack = require(&#x27;webpack&#x27;)
const path = require(&#x27;path&#x27;)

module.exports = {
  // Helpful for error reporting in production
  devtool: &#x27;source-map&#x27;,
  entry: {
    // Entry to your app
    main: path.resolve(&#x27;src&#x27;, &#x27;main.js&#x27;),

    // It is a good idea to separate your npm-packages from
    // the application bundle. By creating an entry specifying
    // the packages and using the CommonsChunkPlugin, Wepback will produce
    // a separate JS file that can be cached by the browser. Meaning
    // that application updates will not require users to download the
    // code for these packages again
    vendors: [
      &#x27;react&#x27;,
      &#x27;react-dom&#x27;,
      &#x27;other-npm-package&#x27;
    ];
  },

  // Output files with hash, also any additional
  // chunks (lazy loading) is to be named with hash
  output: {
    path: path.resolve(&#x27;dist&#x27;),
    filename: &#x27;[name].[chunkhash].js&#x27;,
    chunkFilename: &#x27;[chunkhash].js&#x27;
  },
  module: {
    rules: [

      // CSS loading with css modules
      {
        test: /\.css$/,
        use: [
          {loader: &#x27;style-loader&#x27;},
          {loader: &#x27;css-loader&#x27;, options: {modules: true}}
        ]
      },

      // JS loading with babel
      {
        test: /\.js?$/,
        include: [path.resolve(&#x27;src&#x27;)],
        use: [{
          loader: &#x27;babel-loader&#x27;,
          options: {
            presets: [&#x27;es2015&#x27;, &#x27;react&#x27;],

            // Allows for simple lazy loading
            // (https://webpack.js.org/guides/code-splitting-async/)
            plugins: [&#x27;syntax-dynamic-import&#x27;]
          }
        }]
      }
    ]
  },
  plugins: [
    // Create the index.html file, exposing details
    // about the build (look further down)
    new HtmlWebpackPlugin({
      template: path.resolve(&#x27;index.template.html&#x27;),
      inject: false
    }),

    // Makes the Node environment available in the code,
    // allowing for optimizations. Cerebral and React
    // uses this
    new webpack.DefinePlugin({
      &#x27;process.env&#x27;: {
        NODE_ENV: JSON.stringify(process.env.NODE_ENV)
      }
    })

    // Minify the code
    new webpack.optimize.UglifyJsPlugin({
      beautify: false,
      comments: false,
      compress: {
        warnings: false,
        drop_console: true
      },
      mangle: {
        except: [&#x27;webpackJsonp&#x27;],
        screw_ie8: true
      }
    }),

    // Ensures that the ID of the modules
    // stays the same between builds
    new webpack.HashedModuleIdsPlugin(),

    // Injects the manifest that keeps track
    // of modules registry (saves an HTTP request)
    new InlineManifestWebpackPlugin({
      name: &#x27;webpackManifest&#x27;
    }),

    // Defines the vendors chunk and manifest to
    // be put into own files
    new webpack.optimize.CommonsChunkPlugin({
      names: [&#x27;vendors&#x27;, &#x27;manifest&#x27;]
    })
  ]
};</code></pre><p>The <em>index.html</em> file needs to define where these scripts should be added:</p><pre class="language-html"><code class="language-html">&lt;body&gt;
  &lt;%=htmlWebpackPlugin.files.webpackManifest%&gt;
  &lt;script src=&quot;&lt;%= htmlWebpackPlugin.files.chunks.vendors.entry %&gt;&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;&lt;%= htmlWebpackPlugin.files.chunks.main.entry %&gt;&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre><h2 id="lazy-loading">Lazy loading</h2><p>With the <strong>syntax-dynamic-import</strong> we can easily lazy code any module by simply. Lazy modules automatically gets their own JS file by Webpack, which is loaded on demand into the app:</p><pre class="language-js"><code class="language-js">import(&#x27;path/to/some/module&#x27;)
  .then((module) =&gt; {
    module.default // export default
    module.someOtherExport // export
  })</code></pre><p>In combination with a component you could:</p><pre class="language-js"><code class="language-js">connect({
  page: state`app.page`
}
  class App extends React.Component {
    constructor(props) {
      super(props)
      this.state = {
        isLoadingModule: false,
        loadedModules: [],
        currentModule: null
      }
    }
    componentWillReceiveProps (newProps) {
      if (newProps.page !== this.props.page &amp;&amp; this.state.loadedModules.indexOf(newProps.page) === -1) {
        this.setState({
          isLoadingModule: true
        })
        this.loadModule()
          .then((module) =&gt; {
            this.setState({
              currentModule: module.default,
              isLoadingModule: false
            })
          })
      }
    }
    loadModule () {
      switch (this.props.page) {
        case &#x27;dashboard&#x27;:
          return import(&#x27;pages/dashboard&#x27;)
        case &#x27;admin&#x27;:
          return import(&#x27;pages/admin&#x27;)
        default:
          return Promise.resolve(null)
      }
    }
    render () {
      if (this.state.isLoadingModule) {
        return &lt;div&gt;Loading page...&lt;/div&gt;
      }

      const Page = this.state.currentModule

      return &lt;Page /&gt;
    }
  }
)</code></pre></div></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
