<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><span>install</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/install/index.html">Cerebral</a><a class="docs-navigation-subItem" href="/docs/install/boilerplate.html">Boilerplates</a><a class="docs-navigation-subItem" href="/docs/install/tools.html">Tools</a><a class="docs-navigation-subItem" href="/docs/install/function_tree.html">Function Tree</a></div></li><li class="docs-navigation-item"><span>tutorial</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/tutorial/index.html">Introduction</a><a class="docs-navigation-subItem" href="/docs/tutorial/define_state.html">Define State</a><a class="docs-navigation-subItem" href="/docs/tutorial/render_state.html">Render state</a><a class="docs-navigation-subItem" href="/docs/tutorial/update_state.html">Update state</a><a class="docs-navigation-subItem" href="/docs/tutorial/chains.html">Chains</a><a class="docs-navigation-subItem" href="/docs/tutorial/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/async_actions.html">Async actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/paths.html">Paths</a><a class="docs-navigation-subItem" href="/docs/tutorial/compute_state.html">Compute state</a><a class="docs-navigation-subItem" href="/docs/tutorial/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/tutorial/routing.html">Routing</a><a class="docs-navigation-subItem" href="/docs/tutorial/modules.html">Modules</a></div></li><li class="docs-navigation-item"><span>in depth</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/in_depth/index.html">The architecture</a><a class="docs-navigation-subItem" href="/docs/in_depth/controller.html">Controller</a><a class="docs-navigation-subItem" href="/docs/in_depth/state.html">State</a><a class="docs-navigation-subItem" href="/docs/in_depth/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/in_depth/chains_and_paths.html">Chains and paths</a><a class="docs-navigation-subItem" href="/docs/in_depth/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/in_depth/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/in_depth/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/in_depth/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/in_depth/factories.html">Factories</a><a class="docs-navigation-subItem" href="/docs/in_depth/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/in_depth/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/in_depth/routing.html">Routing</a></div></li><li class="docs-navigation-item active"><span>best practices</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/best_practices/index.html">Organizing</a><a class="docs-navigation-subItem" href="/docs/best_practices/constants.html">Constants</a><a class="docs-navigation-subItem" href="/docs/best_practices/testing.html">Testing</a><a class="docs-navigation-subItem" href="/docs/best_practices/load_initial_data.html">Load initial data</a><a class="docs-navigation-subItem" href="/docs/best_practices/storing_server_data.html">Storing server data</a><a class="docs-navigation-subItem" href="/docs/best_practices/lists.html">Lists</a><a class="docs-navigation-subItem" href="/docs/best_practices/modals.html">Modals</a><a class="docs-navigation-subItem active" href="/docs/best_practices/feedback_messages.html">Feedback messages</a><a class="docs-navigation-subItem" href="/docs/best_practices/popups.html">Popups</a><a class="docs-navigation-subItem" href="/docs/best_practices/long_running_side_effects.html">Long running side effects</a><a class="docs-navigation-subItem" href="/docs/best_practices/server_side.html">Server side</a></div></li><li class="docs-navigation-item"><span>migration</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/migration/index.html">From 1.x to 2.x</a></div></li><li class="docs-navigation-item"><span>api</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/api/index.html">Controller</a><a class="docs-navigation-subItem" href="/docs/api/state.html">State</a><a class="docs-navigation-subItem" href="/docs/api/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/api/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/api/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/api/modules.html">Modules</a><a class="docs-navigation-subItem" href="/docs/api/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/api/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/api/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/api/router.html">Router</a></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="#feedback-messages">Feedback messages</a><ul><li><a href="#a-simple-feedback-message">A simple feedback message</a></li><li><a href="#debouncing">Debouncing</a></li><li><a href="#multiple-messages">Multiple messages</a></li></ul></li></ul></div></div><div class="docs-doc"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/docs/docs/best_practices/feedback_messages.md" target="_new">Edit on Github</a></div><div class="docs-doc-content"><div style="background-color:#DD4A68;color:#fff;margin:10px;padding:5px 10px;border-radius:3px;">Docs are still being written and might not be up to date with API</div><h1 id="feedback-messages">Feedback messages</h1><p>Feedback messages, snackbars, toasts etc. There are many names and approaches to how you give users feedback about what they are doing in your application, and maybe more importantly if something goes wrong. These feedback messages can actually be surprisingly complex. The reason is that you do not know when the next message will appear. Maybe showing the first one is not done yet… what should happen? Should it overwrite the current message, but what about the timing? Should it extend the timing of showing that message? Or maybe you want to display the messages in a list?</p><p>We are going to explore how we can solve these scenarios using Cerebral.</p><h2 id="a-simple-feedback-message">A simple feedback message</h2><p>Let us add a state for showing the message first in our <strong>App</strong> module:</p><pre><code class="language-js">export default {
  state: {
    feedbackMessage: null
  }
}</code></pre><p>Now let us create a chain factory we can compose into any other chain to display this message.</p><pre><code class="language-js">import {set, wait} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

function showMessage (message) {
  return [
    set(state`app.feedbackMessage`, message),
    wait(5000),
    set(state`app.feedbackMessage`, null)
  ]
}

export default showMessage</code></pre><p>We can now compose this chain into another chain, for example doing a request:</p><pre><code class="language-js">import getSomething from &#x27;../actions/getSomething&#x27;
import setSomething from &#x27;../actions/setSomething&#x27;
import feedbackMessage from &#x27;../factories/feedbackMessage&#x27;

export default [
  getSomething, {
    success: [
      setSomething,
      ...feedbackMessage(&#x27;Fetched something!&#x27;)
    ],
    error: [
      ...feedbackMessage(&#x27;Failed fetching something :(&#x27;)
    ]
  }  
]</code></pre><p>But we have an issue here. What if two message appear within 5 seconds? What if another one is triggered after 4 seconds? It will change the text, but after 1 second it will close… instead of waiting a new 5 seconds. And after another 4 seconds it will try to close it again, without needing to.</p><p>Let us see how we can make this better.</p><h2 id="debouncing">Debouncing</h2><p>We can use debouncing instead.</p><pre><code class="language-js">import {set, debounce} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

// We first create a shared debounce. The benefit
// of this is that any use of this showMessage factory
// in any signal will then cancel out existing debounces
const showMessageDebounce = debounce.shared()

function showMessage (message) {
  return [
    set(state`app.feedbackMessage`, message),
    showMessageDebounce(5000), {
      continue: [
        set(state`app.feedbackMessage`, null),
      ],
      discard: []
    }
  ]
}

export default showMessage</code></pre><p>Now we have essentially fixed the problem. If again a new message triggers after 4 seconds, the debounce will discard the first one. If no new messages trigger during 5 seconds it will close the message, or if a new one appears it will again replace the text, discard the previous and wait 5 seconds to close.</p><h2 id="multiple-messages">Multiple messages</h2><p>What if we wanted to stack messages in a list if there were messages there already?</p><p>First let us change our state to handle multiple messages:</p><pre><code class="language-js">export default {
  state: {
    feedbackMessages: []
  }
}</code></pre><p>And now let us rather unshift a new message to the array, then remove all messages when 5 seconds has passed.</p><pre><code class="language-js">import {set, unshift, debounce} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

const showMessageDebounce = debounce.shared()

function showMessage (message) {
  return [
    unshift(state`app.feedbackMessages`, message),
    showMessageDebounce(5000), {
      continue: [
        set(state`app.feedbackMessages`, [])
      ],
      discard: []
    }
  ]
}

export default showMessage</code></pre><p>So now as long as we are showing messages we will stack them on top of each other. When 5 seconds has passed without any new messages it will close and clear out all messages.</p></div></div></div><div class="docs-footer"><div class="docs-footer-column"><div class="docs-footer-header">ORGANIZATION</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral/graphs/contributors" target="_new">Contributors</a><a class="docs-footer-link" href="http://www.webpackbin.com" target="_new">www.webpackbin.com</a><a class="docs-footer-link" href="http://www.christianalfoni.com" target="_new">www.christianalfoni.com</a></div><div class="docs-footer-column"><div class="docs-footer-header">ARTICLES AND USEFUL LINKS</div><a class="docs-footer-link" href="http://medium.com/p/5793c08db2cc" target="_new">The story of Cerebral</a><a class="docs-footer-link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730" target="_new">An unlikely success story</a></div><div class="docs-footer-column"><div class="docs-footer-header">HELP</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral" target="_new">Cerebral github repo</a><a class="docs-footer-link" href="https://discord.gg/0kIweV4bd2bwwsvH" target="_new">Discoard chat</a></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/scroll-detect.js"></script>
  </body>
</html>
