<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><span>install</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/install/index.html">Cerebral</a><a class="docs-navigation-subItem" href="/docs/install/debugger.html">Debugger</a><a class="docs-navigation-subItem" href="/docs/install/boilerplate.html">Boilerplates</a><a class="docs-navigation-subItem" href="/docs/install/tools.html">Tools</a><a class="docs-navigation-subItem" href="/docs/install/function_tree.html">Function Tree</a></div></li><li class="docs-navigation-item active"><span>tutorial</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/tutorial/index.html">Introduction</a><a class="docs-navigation-subItem" href="/docs/tutorial/define_state.html">Define State</a><a class="docs-navigation-subItem" href="/docs/tutorial/render_state.html">Render state</a><a class="docs-navigation-subItem" href="/docs/tutorial/update_state.html">Update state</a><a class="docs-navigation-subItem" href="/docs/tutorial/chains.html">Chains</a><a class="docs-navigation-subItem" href="/docs/tutorial/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/async_actions.html">Async actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/paths.html">Paths</a><a class="docs-navigation-subItem active" href="/docs/tutorial/compute_state.html">Compute state</a><a class="docs-navigation-subItem" href="/docs/tutorial/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/tutorial/routing.html">Routing</a><a class="docs-navigation-subItem" href="/docs/tutorial/modules.html">Modules</a></div></li><li class="docs-navigation-item"><span>in depth</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/in depth/index.html">The architecture</a><a class="docs-navigation-subItem" href="/docs/in depth/controller.html">Controller</a><a class="docs-navigation-subItem" href="/docs/in depth/state.html">State</a><a class="docs-navigation-subItem" href="/docs/in depth/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/in depth/chains_and_paths.html">Chains and paths</a><a class="docs-navigation-subItem" href="/docs/in depth/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/in depth/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/in depth/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/in depth/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/in depth/factories.html">Factories</a><a class="docs-navigation-subItem" href="/docs/in depth/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/in depth/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/in depth/routing.html">Routing</a></div></li><li class="docs-navigation-item"><span>best practices</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/best practices/index.html">Organizing</a><a class="docs-navigation-subItem" href="/docs/best practices/constants.html">Constants</a><a class="docs-navigation-subItem" href="/docs/best practices/testing.html">Testing</a><a class="docs-navigation-subItem" href="/docs/best practices/load_initial_data.html">Load initial data</a><a class="docs-navigation-subItem" href="/docs/best practices/storing_server_data.html">Storing server data</a><a class="docs-navigation-subItem" href="/docs/best practices/lists.html">Lists</a><a class="docs-navigation-subItem" href="/docs/best practices/modals.html">Modals</a><a class="docs-navigation-subItem" href="/docs/best practices/feedback_messages.html">Feedback messages</a><a class="docs-navigation-subItem" href="/docs/best practices/popups.html">Popups</a><a class="docs-navigation-subItem" href="/docs/best practices/long_running_side_effects.html">Long running side effects</a><a class="docs-navigation-subItem" href="/docs/best practices/server_side.html">Server side</a></div></li><li class="docs-navigation-item"><span>migration</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/migration/index.html">From 1.x to 2.x</a></div></li><li class="docs-navigation-item"><span>api</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/api/index.html">Controller</a><a class="docs-navigation-subItem" href="/docs/api/state.html">State</a><a class="docs-navigation-subItem" href="/docs/api/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/api/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/api/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/api/modules.html">Modules</a><a class="docs-navigation-subItem" href="/docs/api/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/api/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/api/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/api/router.html">Router</a></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="#compute-state">Compute state</a><ul><li><a href="#computing">Computing</a></li><li><a href="#replacing-with-computed">Replacing with computed</a></li></ul></li></ul></div></div><div class="docs-doc"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/edit/master/docs/docs/compute_state.md" target="_new">Edit on Github</a></div><div class="docs-doc-content"><div style="background-color:#DD4A68;color:#fff;margin:10px;padding:5px 10px;border-radius:3px;">Docs are still being written and might not be up to date with API</div><h1 id="compute-state">Compute state</h1><p><strong>Load up chapter 08</strong> - <a href="08" target="new">Preview</a></p><p>In our application we want to sum up the number of stars. One approach would be to create an action in our signal:</p><pre><code class="language-js">function setStarsCount({state}) {
  state.set(&#x27;starsCount&#x27;,
    state.get(&#x27;repos.cerebral.stargazers_count&#x27;) +
    state.get(&#x27;repos.addressbar.stargazers_count&#x27;)
  )
}</code></pre><p>This is a perfectly okay approach for our simple scenario, but computing state like this can be tedious in large applications. We might want to use this state multiple places in our application and we want to make sure it is the same wherever we use it.</p><h2 id="computing">Computing</h2><p>In Cerebral we can automatically compute state by using <strong>compute</strong>. It is basically a function that takes any number of arguments to produce a value. Let us look at how it works with our scenario:</p><pre><code class="language-js">import {compute} from &#x27;cerebral&#x27;

export default compute(function starsCount (get) {
  const repos = get.state(&#x27;repos&#x27;)

  return Object.keys(repos).reduce((currentCount, repoKey) =&gt; {
    return currentCount + repos[repoKey].stargazers_count
  }, 0)
})</code></pre><p>We depend on our repos state and declear that we also care about any changes to them. Then we just count the stars and return it. The <strong>get</strong> would also allows you to grab props if it was used with a component or input if it was used in a signal. When the compute is used with a component it will automatically track whatever dependencies it has and only runs when any of those dependencies change.</p><p>Let us finish this example. To do so please create a new folder named <em>./src/computeds</em> and save a file named <em>starsCount.js</em> containing the snippet we just looked at. Then we would like to use our computed both in the signal and we also want to show the count in our component.</p><h2 id="replacing-with-computed">Replacing with computed</h2><p>Let us remove the <strong>setStarsCount</strong> action and just use the computed directly:</p><pre><code class="language-js">...
import starsCount from &#x27;./computeds/starsCount&#x27;
...
{
  buttonClicked: [
    [
      ...showToast(&#x27;Loading data for repos...&#x27;, 2000),
      getRepo(&#x27;cerebral&#x27;), {
        success: [set(state`repos.cerebral`, input`result`)],
        error: []
      },
      getRepo(&#x27;cerebral-debugger&#x27;), {
        success: [set(state`repos.cerebral-debugger`, input`result`)],
        error: []
      }
    ],
    ...showToast(string`The repos have ${starsCount} stars`, 5000)
  ]
}
...</code></pre><p>You can use computeds directly in tags, with operators, in actions and in components:</p><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;
import starsCount from &#x27;../../computeds/starsCount&#x27;
import Toast from &#x27;../Toast&#x27;

export default connect({
  title: state`title`,
  subTitle: state`subTitle`,
  buttonClicked: signal`buttonClicked`,
  starsCount
},
  function App (props) {
    return (
      &lt;div className=&quot;o-container o-container--medium&quot;&gt;
        &lt;h1&gt;{props.title}&lt;/h1&gt;
        &lt;h3&gt;{props.subTitle}&lt;/h3&gt;
        &lt;button
          className=&quot;c-button c-button--info c-button--block&quot;
          onClick={() =&gt; props.buttonClicked()}
        &gt;
          Update star count ({props.starsCount})
        &lt;/button&gt;
        &lt;Toast /&gt;
      &lt;/div&gt;
    )
  }
)</code></pre><p>If you wonder why the button updates its star count before the toast, it is because we have said the “Loading data for repos” should stick for 2 seconds.</p><p>Thats it for now regarding <em>Compute</em>. Of course summarizing some numbers is pretty simple stuff, but you can compute anything.</p><p>But now it has only been Cerebral stuff, what if you want to use other libraries in your action flow? Well, refill your coffee or open up another drink and enjoy the next chapter introducing <strong>providers</strong>.</p><p><strong>Want to dive deeper?</strong> - <a href="../in-depth/11_computed.html" target="new">Go in depth</a>, or move on with the tutorial</p></div></div></div><div class="docs-footer"><div class="docs-footer-column"><div class="docs-footer-header">ORGANIZATION</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral/graphs/contributors" target="_new">Contributors</a><a class="docs-footer-link" href="http://www.webpackbin.com" target="_new">www.webpackbin.com</a><a class="docs-footer-link" href="http://www.christianalfoni.com" target="_new">www.christianalfoni.com</a></div><div class="docs-footer-column"><div class="docs-footer-header">ARTICLES AND USEFUL LINKS</div><a class="docs-footer-link" href="http://medium.com/p/5793c08db2cc" target="_new">The story of Cerebral</a><a class="docs-footer-link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730" target="_new">An unlikely success story</a></div><div class="docs-footer-column"><div class="docs-footer-header">HELP</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral" target="_new">Cerebral github repo</a><a class="docs-footer-link" href="https://discord.gg/0kIweV4bd2bwwsvH" target="_new">Discoard chat</a></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/scroll-detect.js"></script>
  </body>
</html>
