<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><a href="/docs/get_started">get started</a><div class="underline"></div></li><li class="docs-navigation-item active"><a href="/docs/tutorial">tutorial</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/how_to">how to</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/migration">migration</a><div class="underline"></div></li><li class="docs-navigation-item"><a href="/docs/api">api</a><div class="underline"></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div><div class="docs-icons"><a href="https://github.com/cerebral/cerebral" class="docs-icon" target="_new"><div class="docs-icon-github"></div>github repo</a><a href="https://discord.gg/0kIweV4bd2bwwsvH" class="docs-icon" target="_new"><div class="docs-icon-discord"></div>chat</a></div></div><div id="navigation-mobile" class="docs-navigation mobile"><div id="hamburger" class="docs-navigation-hamburger">â˜°</div><div class="docs-navigation-title mobile">tutorial</div><div class="docs-navigation-float mobile"><ul class="docs-navigation-menu mobile"><li class="docs-navigation-item mobile"><a href="/docs/get_started">get started</a></li><li class="docs-navigation-item active mobile"><a href="/docs/tutorial">tutorial</a><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/tutorial/index.html">Introduction</a></li><li><a href="/docs/tutorial/define_state.html">Define State</a></li><li><a href="/docs/tutorial/render_state.html">Render state</a></li><li><a href="/docs/tutorial/update_state.html">Update state</a></li><li><a href="/docs/tutorial/chains.html">Chains</a></li><li><a href="/docs/tutorial/actions.html">Actions</a></li><li class="active"><a href="/docs/tutorial/async_actions.html">Async actions</a><ul><li><a href="#creating-factories">Creating factories</a></li><li><a href="#chain-factories">Chain factories</a></li></ul></li><li><a href="/docs/tutorial/paths.html">Paths</a></li><li><a href="/docs/tutorial/compute_state.html">Compute state</a></li><li><a href="/docs/tutorial/routing.html">Routing</a></li><li><a href="/docs/tutorial/modules.html">Modules</a></li></ul></div></div></li><li class="docs-navigation-item mobile"><a href="/docs/how_to">how to</a></li><li class="docs-navigation-item mobile"><a href="/docs/migration">migration</a></li><li class="docs-navigation-item mobile"><a href="/docs/api">api</a></li></ul></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="/docs/tutorial/index.html">Introduction</a></li><li><a href="/docs/tutorial/define_state.html">Define State</a></li><li><a href="/docs/tutorial/render_state.html">Render state</a></li><li><a href="/docs/tutorial/update_state.html">Update state</a></li><li><a href="/docs/tutorial/chains.html">Chains</a></li><li><a href="/docs/tutorial/actions.html">Actions</a></li><li class="active"><a href="/docs/tutorial/async_actions.html">Async actions</a><ul><li><a href="#creating-factories">Creating factories</a></li><li><a href="#chain-factories">Chain factories</a></li></ul></li><li><a href="/docs/tutorial/paths.html">Paths</a></li><li><a href="/docs/tutorial/compute_state.html">Compute state</a></li><li><a href="/docs/tutorial/routing.html">Routing</a></li><li><a href="/docs/tutorial/modules.html">Modules</a></li></ul></div></div><div class="docs-doc"><div class="docs-doc-content"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/tree/master/docs/docs/docs/tutorial/async_actions.md" target="_new">Edit on Github</a></div><h1 id="async-actions">Async actions</h1><p><strong>Before you start,</strong> <a href="https://webpackbin-prod.firebaseapp.com/#/bins/-KdBPZwKFDQKkAcUqRte" target="new">load this BIN on Webpackbin</a></p><p>Until now we have mostly used synchronous actions inside our <strong>signals</strong> and the flow was, therefore, straightforward. Example:</p><pre><code class="language-js">Controller({
  signals: {
    somethingHappened:[
      action1,
      action2
    ]
  }
})</code></pre><p>Because action2 appears after action1, action1 finishes before action2 starts. Clear enough. But now what happens when action1 executes asynchronously?</p><p>We already have an example of this in our code. The <strong>wait</strong> operator runs asynchronously. It runs for 4 seconds before the toast message is reset.</p><pre><code class="language-js">Controller({
  signals: {
    buttonClicked:[
      set(state`toast`, props`message`),
      wait(4000),
      set(state`toast`, null)
    ]
  }
})</code></pre><p>The signal executes with the same behavior, it waits for an action to resolve before moving to the next. So how does Cerebral know that <strong>wait</strong> is an asynchronous action? Well, the action returns a promise. That means all actions returning a promise is considered an <em>async action</em>.</p><h2 id="creating-factories">Creating factories</h2><p>Let us look at how <strong>wait</strong> is defined:</p><pre><code class="language-js">function waitFactory (ms) {
  function wait () {
    return new Promise((resolve) =&gt; {
      setTimeout(resolve, ms)
    })
  }

  return wait
}</code></pre><p>We have just defined a <strong>factory</strong>. A function that returns an action. The action itself (wait) returns a promise. This promise is what tells the signal to hold its execution until it is resolved.</p><p>Cerebral factories are not only restricted to actions, you can also have chain factories.</p><h2 id="chain-factories">Chain factories</h2><p>Let us create our own custom <strong>showToast</strong> chain factory. Instead of returning an action, we return a chain. As you can see we have moved the actions we defined previously into this array, using the arguments passed into the factory.</p><pre><code class="language-js">...
function showToast(message, ms) {
  return [
    set(state`toast`, message),
    wait(ms),
    set(state`toast`, null)
  ]
}
...
const controller = Controller(...)</code></pre><p>We need to adjust the signal as well:</p><pre><code class="language-js">Controller({
  signals: {
    buttonClicked: [
      shoutIt,
      ...showToast(props`message`, 1000)
    ]
  }
})</code></pre><p>Since <strong>showToast</strong> returns an array we use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator" target="new">spread operator</a> to merge into our existing chain.</p><p>Congratulations! You have successfully mastered the power of factories. But there are a couple of more concepts that will help you define state changes, jump over to the next chapter to find out more.</p><p>If it did not work try jumping to the next chapter or <a href="https://discord.gg/0kIweV4bd2bwwsvH" target="new">shout at us on Discord</a>.</p></div></div></div><div style="z-index:99;background-color:#DD4A68;color:#fff;padding:5px 10px;position:fixed;width:100%;bottom:0;left:0;">Docs are still being written and might not be up to date with API</div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/mobile.js"></script>
  </body>
</html>
