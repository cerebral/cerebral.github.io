<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><span>install</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/install/index.html">Cerebral</a><a class="docs-navigation-subItem" href="/docs/install/debugger.html">Debugger</a><a class="docs-navigation-subItem" href="/docs/install/boilerplate.html">Boilerplates</a><a class="docs-navigation-subItem" href="/docs/install/tools.html">Tools</a><a class="docs-navigation-subItem" href="/docs/install/function_tree.html">Function Tree</a></div></li><li class="docs-navigation-item"><span>tutorial</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/tutorial/index.html">Introduction</a><a class="docs-navigation-subItem" href="/docs/tutorial/define_state.html">Define State</a><a class="docs-navigation-subItem" href="/docs/tutorial/render_state.html">Render state</a><a class="docs-navigation-subItem" href="/docs/tutorial/update_state.html">Update state</a><a class="docs-navigation-subItem" href="/docs/tutorial/chains.html">Chains</a><a class="docs-navigation-subItem" href="/docs/tutorial/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/async_actions.html">Async actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/paths.html">Paths</a><a class="docs-navigation-subItem" href="/docs/tutorial/compute_state.html">Compute state</a><a class="docs-navigation-subItem" href="/docs/tutorial/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/tutorial/routing.html">Routing</a><a class="docs-navigation-subItem" href="/docs/tutorial/modules.html">Modules</a></div></li><li class="docs-navigation-item"><span>in depth</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/in depth/index.html">The architecture</a><a class="docs-navigation-subItem" href="/docs/in depth/controller.html">Controller</a><a class="docs-navigation-subItem" href="/docs/in depth/state.html">State</a><a class="docs-navigation-subItem" href="/docs/in depth/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/in depth/chains_and_paths.html">Chains and paths</a><a class="docs-navigation-subItem" href="/docs/in depth/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/in depth/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/in depth/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/in depth/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/in depth/factories.html">Factories</a><a class="docs-navigation-subItem" href="/docs/in depth/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/in depth/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/in depth/routing.html">Routing</a></div></li><li class="docs-navigation-item active"><span>best practices</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/best practices/index.html">Organizing</a><a class="docs-navigation-subItem" href="/docs/best practices/constants.html">Constants</a><a class="docs-navigation-subItem" href="/docs/best practices/testing.html">Testing</a><a class="docs-navigation-subItem" href="/docs/best practices/load_initial_data.html">Load initial data</a><a class="docs-navigation-subItem" href="/docs/best practices/storing_server_data.html">Storing server data</a><a class="docs-navigation-subItem" href="/docs/best practices/lists.html">Lists</a><a class="docs-navigation-subItem active" href="/docs/best practices/modals.html">Modals</a><a class="docs-navigation-subItem" href="/docs/best practices/feedback_messages.html">Feedback messages</a><a class="docs-navigation-subItem" href="/docs/best practices/popups.html">Popups</a><a class="docs-navigation-subItem" href="/docs/best practices/long_running_side_effects.html">Long running side effects</a><a class="docs-navigation-subItem" href="/docs/best practices/server_side.html">Server side</a></div></li><li class="docs-navigation-item"><span>migration</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/migration/index.html">From 1.x to 2.x</a></div></li><li class="docs-navigation-item"><span>api</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/api/index.html">Controller</a><a class="docs-navigation-subItem" href="/docs/api/state.html">State</a><a class="docs-navigation-subItem" href="/docs/api/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/api/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/api/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/api/modules.html">Modules</a><a class="docs-navigation-subItem" href="/docs/api/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/api/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/api/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/api/router.html">Router</a></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="#modals">Modals</a><ul><li><a href="#increasing-complexity">Increasing complexity</a></li><li><a href="#editing-the-user">Editing the user</a></li></ul></li></ul></div></div><div class="docs-doc"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/edit/master/docs/docs/modals.md" target="_new">Edit on Github</a></div><div class="docs-doc-content"><div style="background-color:#DD4A68;color:#fff;margin:10px;padding:5px 10px;border-radius:3px;">Docs are still being written and might not be up to date with API</div><h1 id="modals">Modals</h1><p>Modals are one of those things that are more complex than you might think. So lets start with a simple modal using a module:</p><p><em>src/modules/app/index.js</em></p><pre><code class="language-js">export default {
  state: {
    title: &#x27;My modal demo&#x27;,
    showMyModal: false
  }
}</code></pre><p>Either we want to show the modal or we do not. To actually trigger the modal we can create a signal that will toggle the state. To simplify the example we define the chain inside the same file:</p><pre><code class="language-js">import {toggle} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default {
  state: {
    title: &#x27;My modal demo&#x27;,
    showMyModal: false
  },
  signals: {
    myModalToggled: [
      toggle(state`app.showMyModal`)
    ]
  }
}</code></pre><p>So in our view we just render the Modal:</p><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;

import MyModal from &#x27;./MyModal&#x27;

export default connect({
  title: state`app.title`
  myModalToggled: signal`app.myModalToggled`
},
  function App(props) {
    return (
      &lt;div onClick={() =&gt; props.myModalToggled()}&gt;
        &lt;h1&gt;{props.title}&lt;/h1&gt;
        &lt;MyModal /&gt;
      &lt;/div&gt;
    )
  }
)</code></pre><p>So what to take note of here is that we have created a specific modal component for our modal. That means if we want multiple modals in our application each of them will have their own <strong>modal</strong> state and component. That does not mean you have to create the backdrop and modal container for each modal, that is just UI, but you create a specific component for each modal and connect what state it wants directly. Lets look at the modal we just created using React as an example:</p><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;

import ModalContainer from &#x27;./ModalContainer&#x27;

export default connect({
  show: state`app.showMyModal`
  myModalToggled: signal`app.myModalToggled`
},
  function MyModal(props) {
    if (!props.show) {
      return null
    }

    return (
      &lt;ModalContainer onClose={props.myModalToggled}&gt;
        Hello modal!
      &lt;/ModalContainer&gt;
    )
  }
)</code></pre><p>We control the modal from within the component. Either it does not show anything or it will render a <strong>fixed</strong> modal container which allows us to pass in a signal to run when the modal should close.</p><h2 id="increasing-complexity">Increasing complexity</h2><p>So let us increase complexity here. What if our modal was a modal to show a user based on a userId? An approach to this is adding a <strong>currentUserId</strong> to state. And instead of having a <strong>modalToggled</strong> kind of signal we have one signal for opening the modal, where we set the passed in <em>userId</em>, and an other for closing it:</p><pre><code class="language-js">import {set} from &#x27;cerebral/operators&#x27;
import {state, input} from &#x27;cerebral/tags&#x27;

export default {
  state: {
    title: &#x27;My modal demo&#x27;,
    showUserModal: false,
    currentUserKey: null,
    users: {}
  },
  signals: {
    userModalOpened: [
      set(state`app.showUserModal`, true),
      set(state`app.currentUserKey`, input`userKey`)
    ],
    userModalClosed: [
      set(state`app.showUserModal`, false)
    ]
  }
}</code></pre><p>Now our modal component can grab the user and update separately from the list:</p><pre><code class="language-js">import React from &#x27;react&#x27;
import {connect} from &#x27;cerebral/react&#x27;
import {state, signal, props} from &#x27;cerebral/tags&#x27;

import ModalContainer from &#x27;./ModalContainer&#x27;

export default connect({
  show: state`app.showMyModal`,
  user: state`app.users.${state`currentUserKey`}`,
  userModalClosed: signal`app.userModalClosed`
},
  function UserModal(props) {
    if (!props.show) {
      return null
    }

    return (
      &lt;ModalContainer onClose={props.userModalClosed}&gt;
        Hello {props.user.name}!
      &lt;/ModalContainer&gt;
    )
  }
)</code></pre><p>What is good about this approach is that you can very easily handle grabbing more information about the user if needed. Lets say we needed to download the user projects when opening the modal:</p><pre><code class="language-js">import {when, set} from &#x27;cerebral/operators&#x27;
import {state, input, string} from &#x27;cerebral/tags&#x27;
import {httpGet} from &#x27;cerebral-provider-http&#x27;

export default {
  state: {
    title: &#x27;My modal demo&#x27;,
    showUserModal: false,
    currentUserKey: null,
    users: {},
    isLoadingProjects: false
  },
  signals: {
    userModalOpened: [
      set(state`app.showUserModal`, true),
      set(state`app.currentUserKey`, input`userKey`),
      set(state`app.isLoadingProjects`, true),
      set(input`userId`, state`app.users.${input`userKey`}.id`),
      httpGet(string`/users/${input`userId`}/projects`), {
        success: [
          set(state`app.users.${input`userKey`}.projects`, input`result`)
        ],
        error: []
      },
      set(state`app.isLoadingProjects`, false)
    ],
    userModalClosed: [
      set(state`app.showUserModal`, false)
    ]
  }
}</code></pre><p>This is not Cerebral complexity, this is application complexity and it has to be defined somewhere. We could hide it in an abstraction or we can describe it exactly as it happens so everybody understands, including the debugger!</p><h2 id="editing-the-user">Editing the user</h2><p>So what if we display the user to edit it? Well, we have to take into account that we probably do not want to edit the user directly, we rather want a copy of the data that will later be merged in with the user if we submit it. So instead of pointing to the user, we will copy over the details of the user for edit in our modal. When the modal close, we update the server:</p><pre><code class="language-js">import {when, set} from &#x27;cerebral/operators&#x27;
import {state, input, string} from &#x27;cerebral/tags&#x27;
import {httpPatch} from &#x27;cerebral-provider-http&#x27;

export default {
  state: {
    title: &#x27;My modal demo&#x27;,
    userModal: {
      show: false,
      fields: {
        firstName: &#x27;&#x27;,
        lastName: &#x27;&#x27;
      }
    },
    users: {},
    isSavingUser: false
  },
  signals: {
    userModalOpened: [
      set(state`app.userModal.show`, true),
      set(state`app.userModal.fields.firstName`, state`users.${input`userKey`}.firstName`),
      set(state`app.userModal.fields.lastName`, state`users.${input`userKey`}.lastName`)
    ],
    userModalClosed: [
      set(input`userId`, state`app.users.${input`userKey`}.id`),
      set(state`isSavingUser`, true),
      httpPatch(string`/users/${input`userId`}`, state`userModal.fields`), {
        success: [
          set(state`isSavingUser`, false),
          set(state`app.userModal.show`, false)
        ],
        error: []
      }
    ]
  }
}</code></pre><p>We brought a lot of complexity into this, but that is important as typically this is what you want to do in applications. Modals can also be handled other ways, for example maybe you want an array of named modals which is mounted by a “modal controller component”. This pretty much works like you would handle pages with the router, though you rather render multiple modals on top of each other. The important thing here is to see that everything is the same. It does not matter the complexity and customization you want to do, you are completely free to do it however you want.</p></div></div></div><div class="docs-footer"><div class="docs-footer-column"><div class="docs-footer-header">ORGANIZATION</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral/graphs/contributors" target="_new">Contributors</a><a class="docs-footer-link" href="http://www.webpackbin.com" target="_new">www.webpackbin.com</a><a class="docs-footer-link" href="http://www.christianalfoni.com" target="_new">www.christianalfoni.com</a></div><div class="docs-footer-column"><div class="docs-footer-header">ARTICLES AND USEFUL LINKS</div><a class="docs-footer-link" href="http://medium.com/p/5793c08db2cc" target="_new">The story of Cerebral</a><a class="docs-footer-link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730" target="_new">An unlikely success story</a></div><div class="docs-footer-column"><div class="docs-footer-header">HELP</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral" target="_new">Cerebral github repo</a><a class="docs-footer-link" href="https://discord.gg/0kIweV4bd2bwwsvH" target="_new">Discoard chat</a></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/scroll-detect.js"></script>
  </body>
</html>
