<!DOCTYPE html>
<html>
  <head>
    <title>Cerebral Docs</title>
    
<link rel="stylesheet" href="/main.css" />
<link rel="stylesheet" href="/prism.css" />
<link rel="stylesheet" href="/docs.css" />
  </head>
  <body>
    <div id="app"><div class="docs-container"><div id="navigation" class="docs-navigation"><ul class="docs-navigation-menu"><li class="docs-navigation-item"><span>install</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/install/index.html">Cerebral</a><a class="docs-navigation-subItem" href="/docs/install/debugger.html">Debugger</a><a class="docs-navigation-subItem" href="/docs/install/boilerplate.html">Boilerplates</a><a class="docs-navigation-subItem" href="/docs/install/tools.html">Tools</a><a class="docs-navigation-subItem" href="/docs/install/function_tree.html">Function Tree</a></div></li><li class="docs-navigation-item"><span>tutorial</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/tutorial/index.html">Introduction</a><a class="docs-navigation-subItem" href="/docs/tutorial/define_state.html">Define State</a><a class="docs-navigation-subItem" href="/docs/tutorial/render_state.html">Render state</a><a class="docs-navigation-subItem" href="/docs/tutorial/update_state.html">Update state</a><a class="docs-navigation-subItem" href="/docs/tutorial/chains.html">Chains</a><a class="docs-navigation-subItem" href="/docs/tutorial/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/async_actions.html">Async actions</a><a class="docs-navigation-subItem" href="/docs/tutorial/paths.html">Paths</a><a class="docs-navigation-subItem" href="/docs/tutorial/compute_state.html">Compute state</a><a class="docs-navigation-subItem" href="/docs/tutorial/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/tutorial/routing.html">Routing</a><a class="docs-navigation-subItem" href="/docs/tutorial/modules.html">Modules</a></div></li><li class="docs-navigation-item"><span>in depth</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/in depth/index.html">The architecture</a><a class="docs-navigation-subItem" href="/docs/in depth/controller.html">Controller</a><a class="docs-navigation-subItem" href="/docs/in depth/state.html">State</a><a class="docs-navigation-subItem" href="/docs/in depth/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/in depth/chains_and_paths.html">Chains and paths</a><a class="docs-navigation-subItem" href="/docs/in depth/actions.html">Actions</a><a class="docs-navigation-subItem" href="/docs/in depth/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/in depth/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/in depth/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/in depth/factories.html">Factories</a><a class="docs-navigation-subItem" href="/docs/in depth/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/in depth/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/in depth/routing.html">Routing</a></div></li><li class="docs-navigation-item active"><span>best practices</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/best practices/index.html">Organizing</a><a class="docs-navigation-subItem" href="/docs/best practices/constants.html">Constants</a><a class="docs-navigation-subItem" href="/docs/best practices/testing.html">Testing</a><a class="docs-navigation-subItem" href="/docs/best practices/load_initial_data.html">Load initial data</a><a class="docs-navigation-subItem" href="/docs/best practices/storing_server_data.html">Storing server data</a><a class="docs-navigation-subItem" href="/docs/best practices/lists.html">Lists</a><a class="docs-navigation-subItem" href="/docs/best practices/modals.html">Modals</a><a class="docs-navigation-subItem" href="/docs/best practices/feedback_messages.html">Feedback messages</a><a class="docs-navigation-subItem active" href="/docs/best practices/popups.html">Popups</a><a class="docs-navigation-subItem" href="/docs/best practices/long_running_side_effects.html">Long running side effects</a><a class="docs-navigation-subItem" href="/docs/best practices/server_side.html">Server side</a></div></li><li class="docs-navigation-item"><span>migration</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/migration/index.html">From 1.x to 2.x</a></div></li><li class="docs-navigation-item"><span>api</span><div class="underline"></div><div class="docs-navigation-subItems"><a class="docs-navigation-subItem" href="/docs/api/index.html">Controller</a><a class="docs-navigation-subItem" href="/docs/api/state.html">State</a><a class="docs-navigation-subItem" href="/docs/api/signals.html">Signals</a><a class="docs-navigation-subItem" href="/docs/api/tags.html">Tags</a><a class="docs-navigation-subItem" href="/docs/api/connect.html">Connect</a><a class="docs-navigation-subItem" href="/docs/api/modules.html">Modules</a><a class="docs-navigation-subItem" href="/docs/api/operators.html">Operators</a><a class="docs-navigation-subItem" href="/docs/api/providers.html">Providers</a><a class="docs-navigation-subItem" href="/docs/api/compute.html">Compute</a><a class="docs-navigation-subItem" href="/docs/api/router.html">Router</a></div></li></ul><div class="docs-search"><input type="text" id="search-docs" placeholder="search..."/><div id="search-result" class="docs-search-result"></div></div></div><div class="docs-content"><div class="docs-toc"><div class="docs-toc-content"><div><strong>Table of contents</strong></div><ul><li><a href="#popups">Popups</a><ul><li><a href="#closing-everything">Closing everything</a></li><li><a href="#prevent-closing">Prevent closing</a></li><li><a href="#dynamic-popups">Dynamic popups</a></li><li><a href="#what-if-cerebral-is-inside-other-app?">What if Cerebral is inside other app?</a></li></ul></li></ul></div></div><div class="docs-doc"><div class="docs-doc-edit"><a href="https://github.com/cerebral/cerebral/edit/master/docs/docs/popups.md" target="_new">Edit on Github</a></div><div class="docs-doc-content"><div style="background-color:#DD4A68;color:#fff;margin:10px;padding:5px 10px;border-radius:3px;">Docs are still being written and might not be up to date with API</div><h1 id="popups">Popups</h1><p>Popups are different than modals. They are more in the realm of dropdowns, popup menus and even tooltips. What they share in behavior is that if you open one of them, the others should close. There are two approaches to this. You can create a stateful component handler for it, or you can use Cerebral and make it very explicit. There is no right answer, it depends on your application. But let us look at the Cerebral approach.</p><h2 id="closing-everything">Closing everything</h2><p>First we need to close all these popup when we click our application. Let us create a chain that closes them:</p><pre><code class="language-js">import {set} from &#x27;cerebral/operators&#x27;;
import {state} from &#x27;cerebral/tags&#x27;

export default [
  set(state`app.showSomePopover`, false)
]</code></pre><p>Now we register this chain to a signal on our <strong>app</strong> module:</p><pre><code class="language-js">import closePopovers from &#x27;./chains/closePopovers&#x27;

export default {
  state: {
    showSomePopover: false
  },
  signals: {
    clicked: closePopovers
  }
}</code></pre><p>And then in our root component we trigger the signal whenever we click our application:</p><pre><code class="language-js">import {connect} from &#x27;cerebral/react&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default connect({}, {
  clicked: state`app.clicked`
},
  function App (props) {
    return (
      &lt;div onClick={() =&gt; props.clicked()}&gt;
        ...
      &lt;/div&gt;
    )
  }
)</code></pre><p>Whenever we now click our application all our popups will close and we can see that behavior in the debugger as well.</p><h2 id="prevent-closing">Prevent closing</h2><p>So when we now click a button to show a popover we have to ensure that our application does not trigger the click event on the root component, because then they will just close again. Let us imagine we have a signal that changes the <em>showSomePopover</em> state to <em>true</em> (showSomePopoverClicked).</p><pre><code class="language-js">import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;

export default connect({
  showSomePopover: state`app.showSomePopover`,
  showSomePopoverClicked: signal`app.showSomePopoverClicked`
},
  function MyPopover(props) {
    return (
      &lt;div onClick={(event) =&gt; {
        event.stopPropagation()
        props.showSomePopoverClicked()
      }}&gt;
        &lt;div&gt;
          Show popover
        &lt;/div&gt;
        {
          props.showSomePopoverClicked ?
            &lt;div&gt;Some popover&lt;/div&gt;
          :
            null
        }
      &lt;/div&gt;
    )
  }
)</code></pre><p>Using <strong>event.stopPropagation()</strong> we prevent any clicks on the button and the popover itself to propagate up to the application root component. So when our chain handling the popover click runs:</p><pre><code class="language-js">import {set} from &#x27;cerebral/operators&#x27;;
import {state} from &#x27;cerebral/tags&#x27;

export default [
  set(state`app.showSomePopover`, true)
]</code></pre><p>We will show the popover. Clicking outside it will hide it. Now, you might want to close all the other popovers when you open a new one. Just compose it in:</p><pre><code class="language-js">import closePopovers from &#x27;../chains/closePopovers&#x27;
import {set} from &#x27;cerebral/operators&#x27;;
import {state} from &#x27;cerebral/tags&#x27;

export default [
  ...closePopovers,
  set(state`app.somePopover`, true)
]</code></pre><p>So this gives you complete control of handling popups and you can make any kind of custom behavior to any of them.</p><h2 id="dynamic-popups">Dynamic popups</h2><p>Sometimes you have a list where each item in the list should show a popup. In this case we want to dynamically open a popup. It is basically the same approach, but we use a state property that takes a reference to the current item instead:</p><pre><code class="language-js">import openItemPopover from &#x27;./chains/openItemPopover&#x27;

export default {
  state: {
    currentItemPopover: null,
    items: {
      &#x27;123&#x27;: {
        title: &#x27;Some item&#x27;
      },
      &#x27;456&#x27;: {
        title: &#x27;Some other item&#x27;
      }
    }
  },
  signals: {
    itemPopoverClicked: openItemPopover
  }
}</code></pre><p>So now let us imagine that we are dynamically building a list of items which contains a popover. For each item we create a new component:</p><pre><code class="language-js">import {connect} from &#x27;cerebral/react&#x27;
import {state, signal, props} from &#x27;cerebral/tags&#x27;

export default connect({
  item: state`app.items.${props`itemKey`}`
  currentItemPopover: state`app.currentItemPopover`
  itemPopoverClicked: signal`app.itemPopoverClicked`
},
  function Item(props) {
    return (
      &lt;div&gt;
        &lt;div&gt;{props.item.title}&lt;/div&gt;
        &lt;div onClick={(event) =&gt; {
          event.stopPropagation()
          props.itemPopoverClicked({
            itemKey: props.itemKey
          })
        }}&gt;
          &lt;div&gt;
            Show popover
          &lt;/div&gt;
          {
            props.currentItemPopover === props.itemKey ?
              &lt;div&gt;Some popover&lt;/div&gt;
            :
              null
          }
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }
)</code></pre><p>What we do here is rather check if the current item popover matches the key of the item itself. So our <strong>openItemPopover</strong> chain would look something like:</p><pre><code class="language-js">import {input, set} from &#x27;cerebral/operators&#x27;
import {state} from &#x27;cerebral/tags&#x27;

export default [
  set(state`app.currentItemPopover`, input`itemKey`)
]</code></pre><p>Now you can again change this behavior. You might use an array instead to allow opening multiple popovers. But this is pretty much how you go about.</p><h2 id="what-if-cerebral-is-inside-other-app?">What if Cerebral is inside other app?</h2><p>If your root component does not cover the whole browser you can rather listen to clicks on the window, using react as example:</p><pre><code class="language-js">import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;

export default connect({
  someState: state`app.someState`,
  clicked: signal`app.clicked`
},
  class App extends React.Component {
    componentDidMount() {
      window.addEventListener(&#x27;click&#x27;, () =&gt; this.props.clicked())
    }
    render() {
      return (
        &lt;div&gt;
          ...
        &lt;/div&gt;
      )
    }
  }
)</code></pre><p>But now we are outside of React own event system. So when you click something you have to make sure that you stop propagating the native event, not React event.</p><pre><code class="language-js">import {connect} from &#x27;cerebral/react&#x27;
import {state, signal} from &#x27;cerebral/tags&#x27;

export default connect({
  showPopover: state`app.showPopover`,
  showPopoverClicked: signal`app.showPopoverClicked`
},
  function MyPopover(props) {
    return (
      &lt;div onClick={(event) =&gt; {
        event.nativeEvent.stopPropagation()
        props.showPopoverClicked()
      }}&gt;
        &lt;div&gt;
          Show popover
        &lt;/div&gt;
        {
          props.showPopover ?
            &lt;div&gt;Some popover&lt;/div&gt;
          :
            null
        }
      &lt;/div&gt;
    )
  }
)</code></pre></div></div></div><div class="docs-footer"><div class="docs-footer-column"><div class="docs-footer-header">ORGANIZATION</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral/graphs/contributors" target="_new">Contributors</a><a class="docs-footer-link" href="http://www.webpackbin.com" target="_new">www.webpackbin.com</a><a class="docs-footer-link" href="http://www.christianalfoni.com" target="_new">www.christianalfoni.com</a></div><div class="docs-footer-column"><div class="docs-footer-header">ARTICLES AND USEFUL LINKS</div><a class="docs-footer-link" href="http://medium.com/p/5793c08db2cc" target="_new">The story of Cerebral</a><a class="docs-footer-link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730" target="_new">An unlikely success story</a></div><div class="docs-footer-column"><div class="docs-footer-header">HELP</div><a class="docs-footer-link" href="https://github.com/cerebral/cerebral" target="_new">Cerebral github repo</a><a class="docs-footer-link" href="https://discord.gg/0kIweV4bd2bwwsvH" target="_new">Discoard chat</a></div></div></div></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
<script src="/search.js"></script>
<script src="/scroll-detect.js"></script>
  </body>
</html>
