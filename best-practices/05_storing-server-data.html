<!DOCTYPE html><html class="ua_js_no" lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Cerebral</title><script>(function(e,c){e[c]=e[c].replace(/(ua_js_)no/g,"$1yes");})(document.documentElement,"className");</script><link rel="stylesheet" href="../css/styles.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:700,500,400"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"/><link rel="shortcut icon" href="../favicon.ico"/><meta name="viewport" content="width=device-width,maximum-scale=1,initial-scale=1,user-scalable=no"/><meta name="format-detection" content="telephone=no"/><link name="apple-mobile-web-app-capable" content="yes"/></head><body class="page page_layout_best-practices"><div class="page__header"><div class="head-nav"><a class="link link__control head-nav__home i-bem" data-bem='{"link":{}}' role="link" href="../"></a></div></div><div class="page__content"><div class="wip">This documentation is about upcoming cerebral v2 which is currently is work in progress.<br/>Documentation might not always describe actual state of API.<br/>API itself could have some notable changes, though it shouldn't be critical.<br/>Feel free to contribute to docs by clicking Edit on Github link.</div><div class="row"><div class="row__col row__col_sw_24 row__col_lw_5 row__col_sol row__col_mol"><div class="side-nav"><div class="menu menu_theme_islands menu_size_xl menu_mode_radio-check menu__control i-bem" data-bem='{"menu":{}}' role="menu" tabindex="0"><div class="menu__group" role="group" aria-labelledby="uniq1484583785603799"><div class="menu__group-title" role="presentation" id="uniq1484583785603799">Install</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"install/01_cerebral"}}' role="menuitemradio" id="uniq1484583785603800" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../install/01_cerebral.html">Cerebral</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"install/02_debugger"}}' role="menuitemradio" id="uniq1484583785603801" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../install/02_debugger.html">Debugger</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"install/03_boilerplate"}}' role="menuitemradio" id="uniq1484583785603802" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../install/03_boilerplate.html">Boilerplate</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"install/04_tools"}}' role="menuitemradio" id="uniq1484583785603803" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../install/04_tools.html">Tools</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"install/05_function-tree"}}' role="menuitemradio" id="uniq1484583785603804" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../install/05_function-tree.html">Function Tree</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1484583785603805"><div class="menu__group-title" role="presentation" id="uniq1484583785603805">Tutorial</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/01_introduction"}}' role="menuitemradio" id="uniq1484583785603806" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/01_introduction.html">Introduction</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/02_define-state"}}' role="menuitemradio" id="uniq1484583785603807" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/02_define-state.html">ch01. Define State</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/03_render-state"}}' role="menuitemradio" id="uniq1484583785603808" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/03_render-state.html">ch02. Render state</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/04_update-state"}}' role="menuitemradio" id="uniq1484583785603809" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/04_update-state.html">ch03. Update state</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/05_using-chains"}}' role="menuitemradio" id="uniq1484583785603810" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/05_using-chains.html">ch04. Chains</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/06_using-inputoutput"}}' role="menuitemradio" id="uniq1484583785603811" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/06_using-inputoutput.html">ch05. Actions</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/07_using-async-actions"}}' role="menuitemradio" id="uniq1484583785603812" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/07_using-async-actions.html">ch06. Async actions</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/08_using-paths"}}' role="menuitemradio" id="uniq1484583785603813" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/08_using-paths.html">ch07. Paths</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/09_compute_state"}}' role="menuitemradio" id="uniq1484583785603814" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/09_compute_state.html">ch08. Compute state</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/10_providers"}}' role="menuitemradio" id="uniq1484583785603815" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/10_providers.html">ch09. Providers</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/11_routing"}}' role="menuitemradio" id="uniq1484583785603816" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/11_routing.html">ch10. Routing</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial/12_refactoring_modules"}}' role="menuitemradio" id="uniq1484583785603817" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial/12_refactoring_modules.html">ch11. Modules</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1484583785603818"><div class="menu__group-title" role="presentation" id="uniq1484583785603818">In depth</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/01_the-architecture"}}' role="menuitemradio" id="uniq1484583785603819" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/01_the-architecture.html">The architecture</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/02_controller"}}' role="menuitemradio" id="uniq1484583785603820" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/02_controller.html">Controller</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/03_state"}}' role="menuitemradio" id="uniq1484583785603821" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/03_state.html">State</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/04_signals"}}' role="menuitemradio" id="uniq1484583785603822" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/04_signals.html">Signals</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/05_chains-and-paths"}}' role="menuitemradio" id="uniq1484583785603823" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/05_chains-and-paths.html">Chains and paths</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/06_actions"}}' role="menuitemradio" id="uniq1484583785603824" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/06_actions.html">Actions</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/07_providers"}}' role="menuitemradio" id="uniq1484583785603825" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/07_providers.html">Providers</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/08_tags"}}' role="menuitemradio" id="uniq1484583785603826" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/08_tags.html">Tags</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/09_operators"}}' role="menuitemradio" id="uniq1484583785603827" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/09_operators.html">Operators</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/10_factories"}}' role="menuitemradio" id="uniq1484583785603828" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/10_factories.html">Factories</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/11_connect"}}' role="menuitemradio" id="uniq1484583785603829" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/11_connect.html">Connect</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/12_computed"}}' role="menuitemradio" id="uniq1484583785603830" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/12_computed.html">Computed</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"in-depth/13_routing"}}' role="menuitemradio" id="uniq1484583785603831" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../in-depth/13_routing.html">Routing</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1484583785603832"><div class="menu__group-title" role="presentation" id="uniq1484583785603832">Best practices</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/01_organizing"}}' role="menuitemradio" id="uniq1484583785603833" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/01_organizing.html">Organizing</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/02_constants"}}' role="menuitemradio" id="uniq1484583785603834" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/02_constants.html">Constants</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/03_testing"}}' role="menuitemradio" id="uniq1484583785603835" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/03_testing.html">Testing</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/04_load-initial-data"}}' role="menuitemradio" id="uniq1484583785603836" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/04_load-initial-data.html">Load initial data</a></div><div class="menu-item menu-item_type_link menu-item_checked menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/05_storing-server-data"}}' role="menuitemradio" id="uniq1484583785603837" aria-checked="true"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/05_storing-server-data.html">Storing server data</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/06_lists"}}' role="menuitemradio" id="uniq1484583785603838" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/06_lists.html">Lists</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/07_modals"}}' role="menuitemradio" id="uniq1484583785603839" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/07_modals.html">Modals</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/08_feedback-message"}}' role="menuitemradio" id="uniq1484583785603840" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/08_feedback-message.html">Feedback messages</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/09_popups"}}' role="menuitemradio" id="uniq1484583785603841" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/09_popups.html">Popups</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/10_long-running-side-effects"}}' role="menuitemradio" id="uniq1484583785603842" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/10_long-running-side-effects.html">Long running side effects</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"best-practices/11_server-side"}}' role="menuitemradio" id="uniq1484583785603843" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../best-practices/11_server-side.html">Server side</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1484583785603844"><div class="menu__group-title" role="presentation" id="uniq1484583785603844">Migration</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"migration/01_start_migration"}}' role="menuitemradio" id="uniq1484583785603845" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../migration/01_start_migration.html">From 1.x to 2.x</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1484583785603846"><div class="menu__group-title" role="presentation" id="uniq1484583785603846">API</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/01_controller"}}' role="menuitemradio" id="uniq1484583785603847" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/01_controller.html">Controller</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/02_state"}}' role="menuitemradio" id="uniq1484583785603848" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/02_state.html">State</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/03_signals"}}' role="menuitemradio" id="uniq1484583785603849" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/03_signals.html">Signals</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/04_tags"}}' role="menuitemradio" id="uniq1484583785603850" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/04_tags.html">Tags</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/05_connect"}}' role="menuitemradio" id="uniq1484583785603851" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/05_connect.html">Connect</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/06_modules"}}' role="menuitemradio" id="uniq1484583785603852" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/06_modules.html">Modules</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/07_operators"}}' role="menuitemradio" id="uniq1484583785603853" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/07_operators.html">Operators</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/08_providers"}}' role="menuitemradio" id="uniq1484583785603854" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/08_providers.html">Providers</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"api/09_router"}}' role="menuitemradio" id="uniq1484583785603855" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../api/09_router.html">Router</a></div></div></div></div></div><div class="row__col row__col_sw_24 row__col_lw_18 row__col_lo_1"><div class="page__edit"><a class="link link_theme_islands link__control i-bem" data-bem='{"link":{}}' role="link" href="https://github.com/cerebral/cerebral/tree/master/docs/docs/content/best-practices/05_storing-server-data.en.md">Edit on GitHub</a></div><h2 class="heading heading_lvl_2" id="storing-server-data">Storing server data</h2>
<p class="paragraph">Your application usually needs to talk to a backend, grab some data and show it to the users. There are thousands of different types of backends and thousands of ways to structure the data. Discussions on how to store this data in the client, caching, optimistic updates, naming properties and endpoints are endless. Cerebral can only show you its preferred practice to solving this, but you are free to do whatever makes sense to you.</p>
<h3 class="heading heading_lvl_3" id="store-as-objects-compute-to-arrays">Store as objects, compute to arrays</h3>
<p class="paragraph">Why do we store data in arrays? And why do we store them as objects? So for example a list of users:</p>
<pre><code class="code" class="lang-js"><span class="token comment" spellcheck="true">// As array</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'Bob'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true">// As object</span>
<span class="token punctuation">{</span>
  <span class="token string">'123'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Bob'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="paragraph">These ways of storing data has different benefits. Arrays are really great for views. Typically views only wants to map over an array of data and create a component for each item in array. Objects though are really great for lookups. If you have the ID of the user it requires way less computation and syntax to grab the user data:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token string">'123'</span>

<span class="token keyword">const</span> userFromArray <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">=</span><span class="token operator">></span> user<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> userFromObject <span class="token operator">=</span> users<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
</code></pre>
<p class="paragraph">So which one should you choose? Well, both! Use objects to structure data in the model and use arrays in your views. Let us see how to achieve that. Imagine you get this data structure from the server:</p>
<pre><code class="code" class="lang-js"><span class="token punctuation">[</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'Bob'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre>
<p class="paragraph">When this data is received you want to convert it to an object:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">function</span> <span class="token function">setUsers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>input<span class="token punctuation">,</span> state<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> input<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>usersMap<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    usersMap<span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> user

    <span class="token keyword">return</span> usersMap
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  state<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'app.users'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="paragraph">Now we have created a map of our users instead for easy lookup:</p>
<pre><code class="code" class="lang-js"><span class="token punctuation">{</span>
  <span class="token string">'123'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Bob'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="paragraph">So let us show all the users in a <strong>Users</strong> component. A naive implementation would be to just grab all the users in the component, iterate over them and create a new <strong>User</strong> component for each user and pass in the user. We will soon see why. So let us use a Computed to do this right:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Computed<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral/tags'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">Computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  users<span class="token punctuation">:</span> state<span class="token template-string"><span class="token string">`app.users`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p class="paragraph">So here we are returning only the keys of all the users. Inside our <strong>Users</strong> component we will only pass the key of the user to the children:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral-view-whatever'</span>
<span class="token keyword">import</span> usersKeys <span class="token keyword">from</span> <span class="token string">'../../computed/usersKeys'</span>
<span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">'../User'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  usersKeys
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">Users</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>usersKeys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userKey<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>User key<span class="token operator">=</span><span class="token punctuation">{</span>userKey<span class="token punctuation">}</span> userKey<span class="token operator">=</span><span class="token punctuation">{</span>userKey<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p class="paragraph">With this approach we can now bind each user specifically to the state it needs, meaning that we isolate the rendering when any of the users update. That means only the component responsible for a specific user will render when that user changes:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral/react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> props<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral/tags'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> state<span class="token template-string"><span class="token string">`users.${props`</span></span>userKey<span class="token template-string"><span class="token string">`}`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre>
<p class="paragraph">So this is one of the benefits we get. Optimized rendering. Now lets look what happens when we want to sort our users. Back in our computed:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Computed<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cerebral/tags'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">Computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  users<span class="token punctuation">:</span> state<span class="token template-string"><span class="token string">`app.users`</span></span><span class="token punctuation">,</span>
  sortOrder<span class="token punctuation">:</span> state<span class="token template-string"><span class="token string">`app.sortOrder`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userAKey<span class="token punctuation">,</span> userBKey<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userA <span class="token operator">=</span> props<span class="token punctuation">.</span>users<span class="token punctuation">[</span>userAKey<span class="token punctuation">]</span>
    <span class="token keyword">const</span> userB <span class="token operator">=</span> props<span class="token punctuation">.</span>users<span class="token punctuation">[</span>userBKey<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>userA<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> userB<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> props<span class="token punctuation">.</span>sortOrder <span class="token operator">===</span> <span class="token string">'asc'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>userA<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> userB<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> props<span class="token punctuation">.</span>sortOrder <span class="token operator">===</span> <span class="token string">'asc'</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p class="paragraph">Now we have a really good data structure for doing lookups of users, but we also have a powerful concept of producing an array of data that the view can use. The good thing is that these computed will only run when their depending state changes and they are in use in the view.</p>
<p class="paragraph">What is also important to remember here is that doing these kind of plain javascript computations is extremely fast, it is rendering the view that takes time.</p>
<h4 class="heading heading_lvl_4" id="optimistic-updates">Optimistic updates</h4>
<p class="paragraph">But we can get other benefits from this as well. Instead of using the user ID as the key, we can create our own:</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> uuid <span class="token keyword">from</span> <span class="token string">'uuid'</span>

<span class="token keyword">function</span> <span class="token function">setUsers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>input<span class="token punctuation">,</span> state<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> input<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>usersMap<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    usersMap<span class="token punctuation">[</span>uuid<span class="token punctuation">.</span><span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> user

    <span class="token keyword">return</span> usersMap
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  state<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'app.users'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="paragraph">Everything works exactly the same, but now we have a client specific reference to our users, instead of ids. This allows us to do optimistic updates.</p>
<pre><code class="code" class="lang-js"><span class="token keyword">import</span> uuid <span class="token keyword">from</span> <span class="token string">'uuid'</span>

<span class="token keyword">function</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>input<span class="token punctuation">,</span> state<span class="token punctuation">,</span> output<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newUserKey <span class="token operator">=</span> uuid<span class="token punctuation">.</span><span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  state<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`app.users.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newUserKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> input<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>newUserKey<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p class="paragraph">We also return the new userKey to the signal so that actions after it can use it to update the user with an ID when the server responds etc.</p>
<p class="paragraph">If you look at the <a class="link link__control i-bem" data-bem='{"link":{}}' role="link" tabindex="0" href="https://cerebral.github.io/todomvc">cerebral-todomvc</a> project you can see this pattern in action.</p>
</div></div></div><footer class="footer page__footer"><div class="row"><div class="row__col row__col_sw_24 row__col_lw_6"><h4 class="footer__header">ORGANIZATION</h4><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="https://github.com/cerebral/cerebral/graphs/contributors">Contributors</a><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="http://www.webpackbin.com">www.webpackbin.com</a><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="http://www.christianalfoni.com">www.christianalfoni.com</a></div><div class="row__col row__col_sw_24 row__col_lw_6 row__col_lo_3"><h4 class="footer__header">ARTICLES AND USEFUL LINKS</h4><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="http://medium.com/p/5793c08db2cc">The story of Cerebral</a><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="https://gist.github.com/christianalfoni/b08a99faa09df054afe87528a2134730">An unlikely success story</a></div><div class="row__col row__col_sw_24 row__col_lw_6 row__col_lo_6"><h4 class="footer__header">HELP</h4><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="https://github.com/cerebral/cerebral">Cerebral github repo</a><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="https://discord.gg/0kIweV4bd2bwwsvH">Discord chat</a></div></div></footer><script src="../js/scripts.min.js"></script></body></html>